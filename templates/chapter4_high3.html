<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sentellect ‚Äî Coordinate Geometry (Chapter 4)</title>

  <!-- MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ===== Base Styles ===== */
    :root {
      --primary: #1e40af;
      --primary-light: #3b82f6;
      --primary-dark: #1e3a8a;
      --secondary: #f59e0b;
      --accent: #ec4899;
      --text: #1e293b;
      --text-light: #64748b;
      --text-lighter: #94a3b8;
      --bg: #f8fafc;
      --white: #ffffff;
      --gray: #e2e8f0;
      --gray-light: #f1f5f9;
      --success: #10b981;
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      --hover-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      --pastel-bg: #f3f8ff;
      --muted: #64748b;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Quicksand', system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    h1, h2, h3, h4 {
      font-weight: 700;
      line-height: 1.2;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    section {
      padding: 80px 0;
      padding-top: 0;
      padding-bottom: 0;
    }

    .section-title {
      text-align: center;
      margin-bottom: 50px;
    }

    .section-title h2 {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 15px;
      position: relative;
      display: inline-block;
    }

    .section-title h2::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: var(--secondary);
      border-radius: 2px;
    }

    .section-title p {
      color: var(--text-light);
      font-size: 1.1rem;
      max-width: 700px;
      margin: 0 auto;
    }

    .btn {
      display: inline-block;
      padding: 12px 28px;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-align: center;
      cursor: pointer;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--white);
      box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.4);
    }

    .btn-secondary {
      background-color: var(--white);
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .btn-secondary:hover {
      background-color: var(--primary);
      color: var(--white);
      transform: translateY(-2px);
    }

    /* ===== Animations ===== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.95); opacity: 0; }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.45); }
    }

    @keyframes wavey {
      0% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }

    .animate {
      animation: fadeIn 0.8s ease forwards;
    }
    
    .animate-slide {
      animation: slideIn 0.6s ease forwards;
    }
    
    .animate-bounce {
      animation: bounceIn 0.8s ease forwards;
    }

    .delay-1 { animation-delay: 0.2s; }
    .delay-2 { animation-delay: 0.4s; }
    .delay-3 { animation-delay: 0.6s; }
    .delay-4 { animation-delay: 0.8s; }

    /* ===== Header/Navbar ===== */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      background-color: var(--white);
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    header.scrolled {
      padding: 10px 0;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(30, 64, 175, 0.2);
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      transition: all 0.3s ease;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 30px;
      margin: 0 auto;
    }

    .nav-links a {
      font-weight: 500;
      position: relative;
      padding: 5px 0;
      transition: color 0.3s ease;
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 3px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      transition: width 0.3s ease;
      border-radius: 2px;
    }

    .nav-links a:hover::after,
    .nav-links a.active::after {
      width: 100%;
    }

    .nav-links a.active {
      color: var(--primary);
      font-weight: 600;
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--primary);
      cursor: pointer;
    }

    /* Sound controls in header */
    .header-sound-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .sound-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .sound-btn:hover {
      transform: scale(1.1);
      background: var(--primary-light);
    }
    
    .sound-btn.muted {
      background: var(--muted);
    }
    
    /* ===== Hero Section ===== */
    .hero {
      position: relative;
      padding: 180px 0 80px;
      background: linear-gradient(135deg, var(--primary), #004e92);
      color: var(--white);
      overflow: hidden;
      text-align: center;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3QgZmlsbD0idXJsKCNwYXR0ZXJuKSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvc3ZnPg==');
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 0 auto;
    }

    .hero h1 {
      font-size: 3.2rem;
      margin-bottom: 20px;
      line-height: 1.2;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .hero h1 span {
      color: var(--secondary);
      position: relative;
    }

    .hero h1 span::after {
      content: '';
      position: absolute;
      bottom: 5px;
      left: 0;
      width: 100%;
      height: 8px;
      background-color: rgba(255, 255, 255, 0.3);
      z-index: -1;
      border-radius: 4px;
    }

    .hero p {
      font-size: 1.2rem;
      margin-bottom: 40px;
      opacity: 0.9;
    }

    .hero-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    .hero .btn-secondary {
      background-color: transparent;
      color: var(--white);
      border-color: var(--white);
    }

    .hero .btn-secondary:hover {
      background-color: var(--white);
      color: var(--primary);
    }

    .floating-shape {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      z-index: 0;
      animation: float 6s ease-in-out infinite;
    }

    .shape-1 {
      width: 150px;
      height: 150px;
      top: 10%;
      left: 10%;
      animation-delay: 0s;
    }

    .shape-2 {
      width: 100px;
      height: 100px;
      bottom: 15%;
      right: 10%;
      animation-delay: 0.5s;
    }

    .shape-3 {
      width: 80px;
      height: 80px;
      top: 30%;
      right: 20%;
      animation-delay: 1s;
    }
    
    .particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
    }
    
    .particle {
      position: absolute;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      animation: float 8s infinite ease-in-out;
    }

    /* ===== Card Styles ===== */
    .card {
      background-color: var(--white);
      border-radius: 16px;
      padding: 30px;
      margin: 25px 0;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary), var(--secondary));
      transition: width 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--hover-shadow);
    }
    
    .card:hover::before {
      width: 8px;
    }

    h2 {
      color: var(--primary);
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 600;
    }

    h3 {
      color: var(--primary);
      font-size: 1.4rem;
      margin: 25px 0 15px;
      font-weight: 600;
      position: relative;
      padding-left: 15px;
    }
    
    h3::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 6px;
      height: 6px;
      background: var(--secondary);
      border-radius: 50%;
    }

    p {
      color: var(--text-light);
      margin-bottom: 20px;
      line-height: 1.7;
    }

    .lead {
      color: var(--muted);
      margin-bottom: 10px;
    }

    /* ===== Step Buttons ===== */
    .step-buttons {
      display: flex;
      gap: 12px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .step-btn {
      padding: 10px 16px;
      background: linear-gradient(to right, var(--primary), var(--primary-light));
      color: var(--white);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: 0 4px 8px rgba(30, 64, 175, 0.2);
    }

    .step-btn:hover {
      background: linear-gradient(to right, var(--primary-dark), var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(30, 64, 175, 0.3);
    }

    /* ===== Solution Display ===== */
    .solution {
      background: var(--gray-light);
      border-left: 4px solid var(--secondary);
      padding: 20px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .solution::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.5), transparent);
      transform: translateX(-100%);
    }
    
    .solution.active::before {
      animation: shimmer 1.5s ease;
    }

    /* ===== Progress Bar ===== */
    .progress-container {
      width: 100%;
      height: 8px;
      background-color: var(--gray);
      border-radius: 4px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      border-radius: 4px;
      width: 0%;
      transition: width 1s ease;
    }

    /* ===== Self-Care Notes ===== */
    .self-care {
      background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
      border-radius: 12px;
      padding: 20px;
      margin: 25px 0;
      text-align: center;
      border-left: 5px solid var(--accent);
      animation: pulse 3s infinite;
    }

    .self-care h4 {
      color: var(--accent);
      margin-bottom: 10px;
      font-size: 1.3rem;
    }

    .self-care p {
      color: var(--text);
      font-size: 1.1rem;
      margin-bottom: 0;
    }

    /* ===== Visual Elements ===== */
    .math-emoji {
      font-size: 2rem;
      margin: 0 10px;
      animation: float 3s ease-in-out infinite;
    }

    .visual-element {
      text-align: center;
      margin: 20px 0;
    }

    .emoji-row {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 15px 0;
    }

    /* Coordinate Visuals */
    .concept-visual {
      display: flex;
      justify-content: center;
      margin: 15px 0;
    }

    .coordinate-visual {
      position: relative;
      width: 280px;
      height: 200px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .grid-lines {
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .axis {
      position: absolute;
      background: #333;
    }

    .x-axis {
      bottom: 50%;
      left: 0;
      width: 100%;
      height: 2px;
    }

    .y-axis {
      left: 50%;
      top: 0;
      width: 2px;
      height: 100%;
    }

    .point {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .point-label {
      position: absolute;
      font-size: 12px;
      font-weight: bold;
      transform: translate(5px, -5px);
    }

    .line {
      position: absolute;
      height: 2px;
      transform-origin: left center;
    }

    /* Concept visuals */
    .visual-box {
      width: 220px;
      height: 160px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 10px;
      position: relative;
      overflow: hidden;
    }

    /* ===== Chapter 4 Specific Styles ===== */
    .definition {
      background: #f3fbff;
      border-left: 6px solid var(--primary);
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .definition-content{flex:1}
    .definition-cartoon{flex-shrink:0;width:80px;height:80px;display:flex;align-items:center;justify-content:center}

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .example {
      background: #fff;
      padding: 12px;
      border-radius: 10px;
      margin-top: 12px;
      border-left: 6px solid #bfe9ff;
    }

    .big {
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 6px;
    }

    .step-block {
      margin-top: 10px;
    }

    .step-line {
      display: none;
      padding: 10px;
      border-radius: 8px;
      background: #f7fbff;
      margin-top: 8px;
      border-left: 4px solid #d6eefc;
    }

    .next-step {
      margin-top: 8px;
      background: var(--primary);
      color: white;
      padding: 8px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    input[type="text"] {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d9ecff;
      width: 100%;
      font-size: 15px;
    }
    input[type="number"] {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d9ecff;
      max-width: 100px;
      font-size: 15px;
    }

    .row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    button.check {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
    }

    .result {
      margin-top: 8px;
      padding: 10px;
      border-radius: 8px;
      display: none;
    }

    .result.good {
      background: #e6fff0;
      border-left: 4px solid #2fb46a;
    }

    .result.warn {
      background: #fff7e6;
      border-left: 4px solid #ffb74d;
    }

    .calm {
      margin-top: 14px;
      padding: 14px;
      border-radius: 10px;
      background: linear-gradient(180deg, #fff8f0, #f8ffff);
      text-align: center;
      border: 1px solid #e6f7ff;
    }

    .breath {
      width: 48px;
      height: 48px;
      background: #ffd08a;
      border-radius: 50%;
      margin: 12px auto;
      animation: breathe 4s infinite ease-in-out;
    }

    .wave {
      font-size: 36px;
      display: inline-block;
      animation: wavey 2.6s infinite;
    }

    .divider {
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      color: white;
      padding: 10px 14px;
      border-radius: 10px;
      margin: 18px 0;
      font-weight: 700;
      box-shadow: 0 6px 18px rgba(3, 102, 214, 0.08);
      text-align: center;
    }

    .small-note {
      font-size: 13px;
      color: var(--text-light);
      margin-top: 6px;
    }

    .funny-note {
      font-size: 14px;
      color: var(--primary);
      margin-top: 6px;
    }

    .scenario {
      display: none;
    }

    .try-yourself {
      background: #fffaf0;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border: 1px dashed rgba(245,158,11,0.16);
    }

    .try-title {
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .example-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .example-box {
      background: var(--pastel-bg);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid rgba(30,64,175,0.04);
    }

    .motivate{
      background:linear-gradient(180deg,#fff,#fffaf6);
      border-radius:10px;
      padding:10px;
      border-left:6px solid var(--accent);
      margin-top:12px;
      display:flex;
      align-items:center;
      gap:12px
    }
    .motivate .emoji{font-size:24px}
    .motivate .text{font-weight:700;color:var(--primary);font-size:0.95rem}

    /* ===== Interactive Games ===== */
    .game-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .game-card-style{
      display:flex;
      gap:16px;
      align-items:center;
      background:var(--white);
      padding:20px;
      border-radius:16px;
      box-shadow:0 8px 25px rgba(2,6,23,0.08);
      cursor:pointer;
      border:1px solid rgba(30,64,175,0.04);
      transition:all 0.3s ease;
      position:relative;
      overflow:hidden
    }
    .game-card-style:hover{
      transform:translateY(-8px);
      box-shadow:0 15px 35px rgba(30,64,175,0.15)
    }
    .game-card-style::before{
      content:"";
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:5px;
      background:linear-gradient(90deg,var(--primary),var(--accent))
    }
    .game-card-left{
      min-width:110px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px
    }
    .svg-icon{
      width:100px;
      height:100px;
      border-radius:16px;
      background:linear-gradient(180deg,#fff,#fffaf6);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 8px 20px rgba(30,64,175,0.08);
      border:2px solid rgba(255,255,255,0.7);
      overflow:hidden;
      font-size: 48px;
      color: var(--primary);
    }
    .game-card-title{
      font-weight:800;
      color:var(--primary);
      font-size:1.2rem;
      margin-bottom:6px
    }
    .game-card-desc{
      color:var(--muted);
      font-size:0.95rem;
      line-height:1.4
    }
    .start-btn {
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(30,64,175,0.2);
    }
    .start-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(30,64,175,0.3);
    }

    .game-play-area {
      display: none;
      margin-top: 20px;
      padding: 20px;
      border: 2px solid var(--accent);
      border-radius: 12px;
      background: #fffafc;
      text-align: center;
    }
    
    .score-board {
      font-weight: 700;
      color: var(--primary);
      background: #f0f9ff;
      padding: 6px 10px;
      border-radius: 6px;
      display: inline-block;
      margin-bottom: 10px;
    }
    
    .game-message {
      margin-top: 12px;
      color: var(--primary);
      font-weight: 600;
    }
    
    .game-input-group {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        font-weight: 600;
        color: var(--primary);
    }
    
    .game-icon-visual {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    /* Midpoint game specific styles - restoring original styling */
    .midpoint-grid {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 12px;
    }
    
    .midpoint-source {
      background: #fff0f6;
      border-radius: 8px;
      padding: 12px;
      border: 2px dashed rgba(236,72,153,0.18);
      cursor: grab;
      min-width: 150px;
      text-align: center;
      margin-bottom: 10px;
    }
    
    .midpoint-target {
      background: #eef9ff;
      border-radius: 8px;
      padding: 12px;
      border: 2px solid rgba(59,130,246,0.12);
      min-width: 150px;
      text-align: center;
      margin-bottom: 10px;
    }
    
    .midpoint-source:hover, .midpoint-target:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Celebration Overlay */
    .celebration {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2000;
      display: none;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #f00;
      opacity: 0;
    }
    
    .hurray-text {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: bold;
      color: #ff6b6b;
      text-shadow: 2px 2px 0 #ffd166, 4px 4px 0 #06d6a0;
      opacity: 0;
    }

    /* Party popper */
    .party-popper {
      position: absolute;
      font-size: 30px;
      opacity: 0;
    }
    
    /* ===== Footer ===== */
    .footer {
      background: linear-gradient(to bottom, var(--primary-dark), #0f172a);
      color: var(--white);
      padding: 80px 0 30px;
      position: relative;
    }

    .footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 10px;
      background: linear-gradient(90deg, var(--secondary), var(--primary));
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 40px;
      margin-bottom: 60px;
    }

    .footer-about {
      grid-column: span 2;
    }

    .footer-logo {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .footer-logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--white), var(--gray));
      color: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.2rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .footer-about p {
      opacity: 0.8;
      margin-bottom: 25px;
      line-height: 1.7;
    }

    .social-links {
      display: flex;
      gap: 15px;
    }

    .social-link {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .social-link:hover {
      background: linear-gradient(135deg, var(--secondary), var(--accent));
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
    }

    .footer-links h3 {
      font-size: 1.2rem;
      margin-bottom: 25px;
      position: relative;
      padding-bottom: 10px;
      color: var(--white);
    }

    .footer-links h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: linear-gradient(to right, var(--secondary), var(--accent));
    }

    .footer-links ul {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 12px;
    }

    .footer-links a {
      opacity: 0.8;
      transition: all 0.3s ease;
      position: relative;
      padding-left: 15px;
    }

    .footer-links a::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .footer-links a:hover {
      opacity: 1;
      padding-left: 20px;
    }

    .footer-links a:hover::before {
      opacity: 1;
      left: -5px;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .footer-bottom p {
      opacity: 0.7;
      margin-bottom: 20px;
    }

    .footer-tags {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .tag {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 5px 15px;
      border-radius: 50px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .tag:hover {
      background: linear-gradient(to right, var(--secondary), var(--accent));
      color: var(--text);
      transform: translateY(-2px);
    }
    
    /* ===== Floating Action Button ===== */
    .fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 6px 15px rgba(30, 64, 175, 0.3);
      cursor: pointer;
      z-index: 999;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
    }
    
    .fab:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 8px 20px rgba(30, 64, 175, 0.4);
    }

    /* ===== Responsive Styles ===== */
    @media (max-width: 992px) {
      .nav-links {
        gap: 20px;
      }
      
      .footer-content {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .footer-about {
        grid-column: span 2;
      }
      
      .scenario .card-mini {
        width: 45%;
      }
    }

    @media (max-width: 768px) {
      .navbar {
        padding: 15px 0;
      }
      
      .nav-links {
        display: none;
      }
      
      .mobile-menu-btn {
        display: block;
      }
      
      .hero h1 {
        font-size: 2.5rem;
      }
      
      .hero-buttons {
        flex-direction: column;
        gap: 15px;
      }
      
      .footer-content {
        grid-template-columns: 1fr;
      }
      
      .footer-about {
        grid-column: span 1;
      }
      
      .scenario .card-mini {
        width: 100%;
      }
      
      .header-sound-controls {
        right: 60px;
      }
    }

    @media (max-width: 576px) {
      .section-title h2 {
        font-size: 2rem;
      }
      
      .hero {
        padding: 150px 0 80px;
      }
      
      .hero h1 {
        font-size: 2rem;
      }
      
      .hero p {
        font-size: 1rem;
      }
      
      .header-sound-controls {
        right: 50px;
      }
    }
    /* =========================================
   MANUAL MODE SWITCHER & SCROLL DETECTION
   ========================================= */

/* 1. Mode Switcher (Floating Top Right) */
.mode-indicator {
    position: fixed;
    top: 100px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    border: 2px solid #dc2626; /* Red for High Stress */
    padding: 10px 20px;
    border-radius: 50px;
    box-shadow: 0 4px 15px rgba(220, 38, 38, 0.2);
    z-index: 999;
    display: flex;
    align-items: center;
    gap: 15px;
    animation: slideInRight 0.5s ease-out;
}

.mode-text {
    color: #dc2626;
    font-weight: bold;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.switch-btn {
    background: linear-gradient(to right, #3b82f6, #2563eb);
    color: white;
    padding: 6px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    text-decoration: none;
}

.switch-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
    color: white;
}

/* 2. Scroll Modal (Hidden by default) */
#scrollModal {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(2px);
}

.scroll-modal-content {
    background: white;
    padding: 30px;
    border-radius: 20px;
    max-width: 450px;
    text-align: center;
    border-top: 6px solid #f59e0b; /* Orange for Warning */
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

/* Animations & Responsiveness */
@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@media (max-width: 768px) {
    .mode-indicator {
        top: auto;
        bottom: 20px;
        right: 50%;
        transform: translateX(50%);
        width: 90%;
        justify-content: space-between;
    }
}
  </style>
</head>
<body>
  <div class="mode-indicator">
    <div class="mode-text">
        <i class="fas fa-fire"></i> Challenge Mode
    </div>
    <a href="{{ url_for('serve_chapter', chapter_num=2) }}?mode=mid" class="switch-btn">
        Switch to Standard
    </a>
</div>

<div id="scrollModal">
    <div class="scroll-modal-content">
        <h3 style="color:#d97706; margin-bottom:15px;">üèéÔ∏è Woah, slowing down?</h3>
        <p style="font-size:1.1rem; color:#555; margin-bottom:20px;">
            We noticed you are scrolling quite fast. <br><br>
            If you are looking for a more structured flow without the relaxation elements, the <b>Standard Mode</b> might be a better fit.
        </p>
        
        <div style="display:flex; gap:15px; justify-content:center; margin-top:20px;">
            <button onclick="closeScrollModal()" style="padding:10px 20px; border:1px solid #ccc; background:white; border-radius:50px; cursor:pointer; font-weight:600; color:#666;">I'm just skimming</button>
            <a href="{{ url_for('serve_chapter', chapter_num=2) }}?mode=mid" style="padding:10px 25px; background:#3b82f6; color:white; border-radius:50px; text-decoration:none; font-weight:600; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);">
                Switch to Standard
            </a>
        </div>
    </div>
</div>
  <!-- Celebration Overlay -->
  <div class="celebration" id="celebration"></div>

  <!-- Header with updated navigation -->
  <header>
    <div class="container">
      <nav class="navbar">
        <a href="#" class="logo">
          <div class="logo-icon">S</div>
          <span class="logo-text">Sentellect</span>
        </a>
        
        <ul class="nav-links">
          <li><a href="#" class="active">Home</a></li>
          <li><a href="#slope">Introduction</a></li>
          <li><a href="#parallel">Graphing</a></li>
          <li><a href="#forms">Systems</a></li>
          <li><a href="#distance">Practice</a></li>
          <li><a href="#games">Games</a></li>
        </ul>
        
        <!-- Sound controls in header - moved to top right -->
        <div class="header-sound-controls">
          <button class="sound-btn" id="toggleSound" title="Toggle sound effects">
            <i class="fas fa-volume-up"></i>
          </button>
        </div>
        
        <button class="mobile-menu-btn">
          <i class="fas fa-bars"></i>
        </button>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" role="banner" aria-label="Chapter 4 hero">
    <div class="particles">
      <div class="particle" style="top: 20%; left: 5%; width: 10px; height: 10px; animation-delay: 0s;"></div>
      <div class="particle" style="top: 60%; left: 15%; width: 15px; height: 15px; animation-delay: 1s;"></div>
      <div class="particle" style="top: 30%; right: 10%; width: 12px; height: 12px; animation-delay: 2s;"></div>
      <div class="particle" style="bottom: 20%; left: 20%; width: 8px; height: 8px; animation-delay: 3s;"></div>
      <div class="particle" style="bottom: 40%; right: 15%; width: 14px; height: 14px; animation-delay: 4s;"></div>
    </div>
    
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
    
    <div class="container">
      <div class="hero-content">
        <h1 class="animate">Coordinate Geometry ‚Äî Chapter 4</h1>
        <p class="animate delay-1">Exercise 4.3(H):Slope, Parallel/Perpendicular Conditions, and Distance Formula with interactive games.</p>
        <div class="hero-buttons">
          <a href="#slope" class="btn btn-primary animate delay-2">Start Learning</a>
          <a href="#games" class="btn btn-secondary animate delay-3">Open Games</a>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <div class="container" style="padding-bottom:60px;">

    <!-- Welcome card -->
    <div class="card animate">
      <h2>Welcome to Straight Lines Master Module</h2>
      <p class="lead">This module contains all examples, try-it-yourself exercises, and seven functional, playable games to practice the key ideas with confidence.</p>
      
      <!-- Welcome visual -->
      <div class="concept-visual">
        <div class="visual-box" style="background:linear-gradient(135deg, #e3f2fd, #f3e5f5); display:flex; align-items:center; justify-content:center;">
          <div style="text-align:center">
            <div style="font-size:40px; margin-bottom:10px">üìà</div>
            <div style="font-weight:bold; color:var(--primary)">Let's Explore Straight Lines!</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ================= SLOPE AND COLLINEARITY ================= -->
    <div id="slope" class="divider">1. Slope and Collinearity</div>
    <section class="card animate delay-1">
      <h2>Measuring Steepness and Direction (m)</h2>
      <p class="lead">The <strong>slope</strong> (m) tells us the steepness, and <strong>collinearity</strong> determines if points share the same slope. Think of slope like the incline of a small hill!</p>

      <div class="definition">
        <div class="definition-content">
          <strong>Slope Formula:</strong> \( m = \frac{y_2 - y_1}{x_2 - x_1} \)
          <br><strong>Collinearity Test:</strong> Slope AB = Slope BC
          <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:24px">üèîÔ∏è</span>
            <span>Think of slope like the incline of a small hill!</span>
          </div>
        </div>
        <div class="definition-cartoon">
          <!-- Mountain slope cartoon -->
          <svg viewBox="0 0 100 100" width="80" height="80" xmlns="http://www.w3.org/2000/svg">
            <!-- Mountain -->
            <path d="M10 80 L50 20 L90 80 Z" fill="#8B9D83" />
            <path d="M20 80 L50 40 L80 80 Z" fill="#A8B8A0" />
            
            <!-- Slope lines -->
            <line x1="30" y1="70" x2="70" y2="70" stroke="#5D4037" stroke-width="2" />
            <line x1="30" y1="70" x2="50" y2="30" stroke="#5D4037" stroke-width="2" />
            
            <!-- Slope labels -->
            <text x="40" y="65" font-size="6" fill="#5D4037" text-anchor="middle">Run</text>
            <text x="38" y="50" font-size="6" fill="#5D4037" text-anchor="middle">Rise</text>
            
            <!-- Slope formula -->
            <text x="50" y="90" font-size="7" fill="#1e40af" text-anchor="middle">m = Rise/Run</text>
            
            <!-- Sun -->
            <circle cx="80" cy="25" r="8" fill="#FFD166" />
            <path d="M80 15 L80 10 M80 35 L80 40 M65 25 L60 25 M95 25 L100 25 M70 15 L65 10 M70 35 L65 40 M90 15 L95 10 M90 35 L95 40" stroke="#FFD166" stroke-width="2" />
          </svg>
        </div>
      </div>

      <!-- Slope Visual -->
      <div class="concept-visual">
        <div class="coordinate-visual">
          <div class="grid-lines"></div>
          <div class="x-axis"></div>
          <div class="y-axis"></div>
          <div class="point" style="background:#ec4899; top:30%; left:20%;"></div>
          <div class="point-label" style="top:30%; left:20%; color:#ec4899;">A(2,4)</div>
          <div class="point" style="background:#3b82f6; top:70%; left:80%;"></div>
          <div class="point-label" style="top:70%; left:80%; color:#3b82f6;">B(8,13)</div>
          <div class="line" style="background:#f59e0b; top:30%; left:20%; width:70%; transform:rotate(45deg);"></div>
          <div class="point-label" style="top:50%; left:45%; color:#f59e0b; font-size:10px;">m = 1.5</div>
        </div>
      </div>

      <!-- Examples -->
      <div class="example-container">
        <div class="example-box">
          <div class="big">Example 1: Slope for (-2,4) and (5,11)</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('slope1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="slope1">
            <div class="step-line" style="display:none"><b>Step 1:</b> Calculate slope: \( m = \frac{11-4}{5-(-2)} = \frac{7}{7} = 1 \)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Find inclination: \( \tan \alpha = 1 \Rightarrow \alpha = 45^\circ \)</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('slope1'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Example 2: Check collinearity of (1,2), (3,4), (5,6)</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('coll3'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="coll3">
            <div class="step-line" style="display:none"><b>Step 1:</b> \(m_{AB} = \frac{4-2}{3-1} = 1\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> \(m_{BC} = \frac{6-4}{5-3} = 1\)</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Since \(m_{AB} = m_{BC}\), the points are <strong>collinear</strong>.</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('coll3'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Example 3: Vertical line slope for (4,6) and (4,8)</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('slope3'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="slope3">
            <div class="step-line" style="display:none"><b>Step 1:</b> Calculate slope: \( m = \frac{8-6}{4-4} = \frac{2}{0} = \infty \)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Find inclination: \( \alpha = 90^\circ \)</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('slope3'); playSound('click')">Next Step</button></div>
          </div>
        </div>
      </div>

      <!-- Try yourself -->
      <div class="try-yourself">
        <div class="try-title">‚ú® Try It Yourself</div>
        <p>1. Find the slope of the line joining (5,-3) and (-2,4)</p>
        <div class="row">
          <input id="tslope1" placeholder="Enter slope">
          <button class="check" onclick="checkTextMotivate('tslope1','-1','tslope1_res')">Check</button>
        </div>
        <div id="tslope1_res" class="result"></div>
      </div>

      <!-- Motivational message -->
      <div class="motivate">
        <div class="emoji">üåº‚ú®</div>
        <div class="text" style="color:#ec4899;">Wow! You're mastering slopes like a pro! üéØ</div>
      </div>

      <!-- Game card for Slope -->
      <h3 style="margin-top:18px;color:var(--accent)">Play the Slope Games</h3>
      <div class="game-card-grid">
        <div class="game-card-style" onclick="showGame('slope-shooter-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #ff7eb3, #ff758c);">
              <!-- Mountain slope SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Mountain -->
                <path d="M10 80 L50 20 L90 80 Z" fill="#8B9D83" />
                <path d="M20 80 L50 40 L80 80 Z" fill="#A8B8A0" />
                
                <!-- Slope lines -->
                <line x1="30" y1="70" x2="70" y2="70" stroke="#5D4037" stroke-width="3" />
                <line x1="30" y1="70" x2="50" y2="30" stroke="#5D4037" stroke-width="3" />
                
                <!-- Slope labels -->
                <text x="40" y="65" font-size="8" fill="#5D4037" text-anchor="middle">Run</text>
                <text x="38" y="50" font-size="8" fill="#5D4037" text-anchor="middle">Rise</text>
                
                <!-- Slope formula -->
                <text x="50" y="90" font-size="10" fill="#1e40af" text-anchor="middle" font-weight="bold">m = Rise/Run</text>
                
                <!-- Sun -->
                <circle cx="80" cy="25" r="10" fill="#FFD166" />
                <path d="M80 15 L80 10 M80 35 L80 40 M65 25 L60 25 M95 25 L100 25 M70 15 L65 10 M70 35 L65 40 M90 15 L95 10 M90 35 L95 40" stroke="#FFD166" stroke-width="3" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Mountain Adventure</div>
          </div>
          <div>
            <div class="game-card-title">Slope Calculator</div>
            <div class="game-card-desc">Quickly find the slope from two points in this mountain adventure!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Game



            </button></div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('collinearity-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #65C7F7, #4ECDC4);">
              <!-- Collinear points SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Straight line -->
                <line x1="15" y1="50" x2="85" y2="50" stroke="#4ECDC4" stroke-width="8" stroke-linecap="round" />
                
                <!-- Points on the line -->
                <circle cx="25" cy="50" r="8" fill="#EF476F" />
                <circle cx="50" cy="50" r="8" fill="#FFD166" />
                <circle cx="75" cy="50" r="8" fill="#06D6A0" />
                
                <!-- Point labels -->
                <text x="25" y="40" font-size="8" fill="#EF476F" text-anchor="middle" font-weight="bold">A</text>
                <text x="50" y="40" font-size="8" fill="#FFD166" text-anchor="middle" font-weight="bold">B</text>
                <text x="75" y="40" font-size="8" fill="#06D6A0" text-anchor="middle" font-weight="bold">C</text>
                
                <!-- Checkmarks for collinearity -->
                <path d="M30 65 L35 70 L45 60" stroke="#06D6A0" stroke-width="4" fill="none" />
                <text x="50" y="68" font-size="10" fill="#06D6A0" text-anchor="middle" font-weight="bold">Collinear!</text>
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Alignment Check</div>
          </div>
          <div>
            <div class="game-card-title">Slope Spotter</div>
            <div class="game-card-desc">Test if three points are collinear by checking their slopes!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Game</button></div>
          </div>
        </div>
      </div>

      <div id="slope-shooter-game" class="game-play-area">
        <div class="score-board" id="slope-score-display">Score: 0</div>
        <div class="game-icon-visual">üèîÔ∏è</div>
        <div class="game-prompt" id="slope-prompt">Points: (2, 4) and (5, 13)</div>
        <div class="game-input-group">
          m: <input type="text" id="slope-m-input" placeholder="Slope (e.g., 3)">
        </div>
        <button class="check" onclick="checkSlope()">Submit</button>
        <div class="game-message" id="slope-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initSlopeGame(); playSound('click')">New Problem</button>
      </div>

      <div id="collinearity-game" class="game-play-area">
        <div class="score-board" id="collinearity-score-display">Score: 0</div>
        <div class="game-icon-visual">üöÇ</div>
        <div class="game-prompt" id="collinearity-prompt">A(1, 2), B(3, 4), C(5, 6)</div>
        <div class="game-input-group">
          <button class="check" onclick="checkCollinearity(true)">YES (Slopes match!)</button>
          <button class="check" style="background:#ef4444" onclick="checkCollinearity(false)">NO (They form a triangle!)</button>
        </div>
        <div class="game-message" id="collinearity-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initCollinearityGame(); playSound('click')">Next Check</button>
      </div>

      <div class="calm">
        <div class="wave">üåà</div>
        <div style="font-weight:700">Take a breath ‚Äî you're doing great!</div>
      </div>
    </section>

    <!-- ================= PARALLEL AND PERPENDICULAR LINES ================= -->
    <div id="parallel" class="divider">2. Parallel and Perpendicular Lines</div>
    <section class="card animate delay-2">
      <h2>Relationships Between Lines</h2>
      <p class="lead">Lines can be <strong>parallel</strong> (run side-by-side, \(m_1 = m_2\)) or <strong>perpendicular</strong> (cross at 90¬∞, \(m_1 \times m_2 = -1\)).</p>

      <div class="definition">
        <div class="definition-content">
          <strong>Parallel Lines:</strong> \( m_1 = m_2 \)
          <br><strong>Perpendicular Lines:</strong> \( m_1 \times m_2 = -1 \)
          <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:24px">üõ§Ô∏è</span>
            <span>Parallel lines never meet, perpendicular lines cross at right angles!</span>
          </div>
        </div>
        <div class="definition-cartoon">
          <!-- Parallel and perpendicular lines cartoon -->
          <svg viewBox="0 0 100 100" width="80" height="80" xmlns="http://www.w3.org/2000/svg">
            <!-- Parallel lines -->
            <line x1="10" y1="30" x2="90" y2="30" stroke="#3b82f6" stroke-width="4" />
            <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="4" />
            <text x="50" y="25" font-size="6" fill="#3b82f6" text-anchor="middle">Parallel: m‚ÇÅ = m‚ÇÇ</text>
            
            <!-- Perpendicular lines -->
            <line x1="30" y1="70" x2="70" y2="70" stroke="#ec4899" stroke-width="4" />
            <line x1="50" y1="50" x2="50" y2="90" stroke="#ec4899" stroke-width="4" />
            
            <!-- Right angle indicator -->
            <path d="M45 70 L50 70 L50 75" stroke="#ec4899" stroke-width="2" fill="none" />
            <text x="65" y="85" font-size="6" fill="#ec4899" text-anchor="middle">Perpendicular: m‚ÇÅ√óm‚ÇÇ = -1</text>
          </svg>
        </div>
      </div>

      <!-- Parallel/Perpendicular Visual -->
      <div class="concept-visual">
        <div class="coordinate-visual">
          <div class="grid-lines"></div>
          <div class="x-axis"></div>
          <div class="y-axis"></div>
          <!-- Parallel lines -->
          <div class="line" style="background:#3b82f6; top:30%; left:10%; width:80%;"></div>
          <div class="line" style="background:#3b82f6; top:50%; left:10%; width:80%;"></div>
          <div class="point-label" style="top:40%; left:50%; color:#3b82f6; font-size:10px;">Parallel: m‚ÇÅ = m‚ÇÇ</div>
          <!-- Perpendicular lines -->
          <div class="line" style="background:#ec4899; top:70%; left:30%; width:40%;"></div>
          <div class="line" style="background:#ec4899; top:50%; left:50%; width:2px; height:40%; transform:rotate(90deg);"></div>
          <div class="point-label" style="top:80%; left:50%; color:#ec4899; font-size:10px;">Perpendicular: m‚ÇÅ√óm‚ÇÇ = -1</div>
        </div>
      </div>

      <div class="example-container">
        <div class="example-box">
          <div class="big">Example 1: Find k for parallel lines</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('par1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="par1">
            <div class="step-line" style="display:none"><b>Step 1:</b> \(m_{CD} = \frac{1}{2}\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> \(m_{AB} = \frac{-9}{k-7}\)</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Set \(m_{AB} = m_{CD}\): \(k = -11\)</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('par1'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Example 2: Find k for perpendicular lines</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('perp1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="perp1">
            <div class="step-line" style="display:none"><b>Step 1:</b> \(m_{CD} = \frac{1}{2}\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> \(m_{AB} = \frac{-9}{k-7}\)</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Set \(m_{AB} \times m_{CD} = -1\): \(k = 11.5\)</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('perp1'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Example 3: Right triangle verification</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('right1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="right1">
            <div class="step-line" style="display:none"><b>Step 1:</b> \(m_{AB} = -\frac{3}{2}\) and \(m_{CA} = \frac{2}{3}\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Check: \(m_{AB} \times m_{CA} = -1\)</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Conclusion: Triangle is <strong>right-angled at A</strong>.</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('right1'); playSound('click')">Next Step</button></div>
          </div>
        </div>
      </div>

      <div class="motivate">
        <div class="emoji">üå∏üí´</div>
        <div class="text" style="color:#f59e0b;">Amazing! Your line relationship skills are out of this world! üöÄ</div>
      </div>

      <!-- Game card for Parallel/Perpendicular -->
      <h3 style="margin-top:16px;color:var(--accent)">Play the Parallel & Perpendicular Games</h3>
      <div class="game-card-grid">
        <div class="game-card-style" onclick="showGame('parallel-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #FFD166, #EF476F);">
              <!-- Parallel lines SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Parallel lines -->
                <line x1="10" y1="30" x2="90" y2="30" stroke="#3b82f6" stroke-width="6" />
                <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="6" />
                <line x1="10" y1="70" x2="90" y2="70" stroke="#3b82f6" stroke-width="6" />
                
                <!-- Equal signs between lines -->
                <line x1="40" y1="38" x2="60" y2="38" stroke="#1e40af" stroke-width="3" />
                <line x1="40" y1="42" x2="60" y2="42" stroke="#1e40af" stroke-width="3" />
                
                <line x1="40" y1="58" x2="60" y2="58" stroke="#1e40af" stroke-width="3" />
                <line x1="40" y1="62" x2="60" y2="62" stroke="#1e40af" stroke-width="3" />
                
                <!-- Formula -->
                <text x="50" y="20" font-size="10" fill="#1e40af" text-anchor="middle" font-weight="bold">m‚ÇÅ = m‚ÇÇ</text>
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Parallel Finder</div>
          </div>
          <div>
            <div class="game-card-title">Parallel Finder</div>
            <div class="game-card-desc">Identify the unknown coefficient (k) that makes two lines parallel!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Game</button></div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('perpendicular-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #06D6A0, #118AB2);">
              <!-- Perpendicular lines SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Perpendicular lines -->
                <line x1="30" y1="70" x2="70" y2="70" stroke="#ec4899" stroke-width="6" />
                <line x1="50" y1="50" x2="50" y2="90" stroke="#ec4899" stroke-width="6" />
                
                <!-- Right angle indicator -->
                <path d="M45 70 L50 70 L50 75" stroke="#ec4899" stroke-width="3" fill="none" />
                
                <!-- Multiplication sign -->
                <circle cx="50" cy="30" r="15" fill="#f0f9ff" stroke="#ec4899" stroke-width="3" />
                <line x1="42" y1="23" x2="58" y2="37" stroke="#ec4899" stroke-width="3" />
                <line x1="42" y1="37" x2="58" y2="23" stroke="#ec4899" stroke-width="3" />
                
                <!-- Equal sign and -1 -->
                <line x1="62" y1="28" x2="72" y2="28" stroke="#ec4899" stroke-width="3" />
                <line x1="62" y1="32" x2="72" y2="32" stroke="#ec4899" stroke-width="3" />
                <text x="82" y="32" font-size="12" fill="#ec4899" text-anchor="middle" font-weight="bold">-1</text>
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Perpendicular Solver</div>
          </div>
          <div>
            <div class="game-card-title">Perpendicular Solver</div>
            <div class="game-card-desc">Identify the unknown coefficient (k) that makes two lines perpendicular!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Game</button></div>
          </div>
        </div>
      </div>

      <div id="parallel-game" class="game-play-area">
        <div class="score-board" id="parallel-score-display">Score: 0</div>
        <div class="game-icon-visual">‚à•</div>
        <div class="game-prompt" id="parallel-prompt">Line 1: (7, 3) to (k, -6). Line 2: (-4, 5) to (-6, 4).</div>
        <div class="game-input-group">
          k: <input type="number" id="parallel-k-input" placeholder="k">
        </div>
        <button class="check" onclick="checkParallel()">Submit</button>
        <div class="game-message" id="parallel-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initParallelGame(); playSound('click')">New Problem</button>
      </div>

      <div id="perpendicular-game" class="game-play-area">
        <div class="score-board" id="perpendicular-score-display">Score: 0</div>
        <div class="game-icon-visual">‚üÇ</div>
        <div class="game-prompt" id="perpendicular-prompt">Line 1: (7, 3) to (k, -6). Line 2: (-4, 5) to (-6, 4).</div>
        <div class="game-input-group">
          k: <input type="number" id="perpendicular-k-input" placeholder="k (Decimal)">
        </div>
        <button class="check" onclick="checkPerpendicular()">Submit</button>
        <div class="game-message" id="perpendicular-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initPerpendicularGame(); playSound('click')">New Problem</button>
      </div>

      <div class="calm">
        <div class="breath"></div>
        <div style="font-weight:700">Keep going ‚Äî small steps make big improvements.</div>
      </div>
    </section>

    <!-- ================= DIFFERENT FORMS OF LINE EQUATIONS ================= -->
    <div id="forms" class="divider">3. Different Forms of Line Equations</div>
    <section class="card animate delay-3">
      <h2>Various Ways to Represent a Line</h2>
      <p class="lead">A single line can be written in multiple forms: Slope-Intercept (\(y=mx+c\)), General (\(Ax+By+C=0\)), etc. <strong>We are only changing the format, not the line itself!</strong></p>

      <div class="definition">
        <div class="definition-content">
          <strong>Slope-Intercept Form:</strong> \( y = mx + c \)
          <br><strong>General Form:</strong> \( Ax + By + C = 0 \)
          <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:24px">üîÑ</span>
            <span>Different forms, same line - just rearranged!</span>
          </div>
        </div>
        <div class="definition-cartoon">
          <!-- Form conversion cartoon -->
          <svg viewBox="0 0 100 100" width="80" height="80" xmlns="http://www.w3.org/2000/svg">
            <!-- Line in different forms -->
            <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="3" />
            
            <!-- Form 1: Slope-Intercept -->
            <rect x="5" y="15" width="40" height="20" rx="3" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2" />
            <text x="25" y="28" font-size="6" fill="#3b82f6" text-anchor="middle">y = mx + c</text>
            
            <!-- Arrow -->
            <path d="M50 25 L60 25 L60 20 L65 25 L60 30 L60 25" fill="#3b82f6" />
            
            <!-- Form 2: General Form -->
            <rect x="70" y="15" width="25" height="20" rx="3" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2" />
            <text x="82" y="28" font-size="6" fill="#3b82f6" text-anchor="middle">Ax+By+C=0</text>
            
            <!-- Conversion arrows -->
            <path d="M25 40 L25 60 L20 60 L25 65 L30 60 L25 60" fill="#ec4899" />
            <path d="M82 40 L82 60 L77 60 L82 65 L87 60 L82 60" fill="#ec4899" />
            
            <!-- Equal sign -->
            <line x1="40" y1="80" x2="60" y2="80" stroke="#10b981" stroke-width="3" />
            <line x1="40" y1="83" x2="60" y2="83" stroke="#10b981" stroke-width="3" />
          </svg>
        </div>
      </div>

      <!-- Form Conversion Visual -->
      <div class="concept-visual">
        <div class="coordinate-visual">
          <div class="grid-lines"></div>
          <div class="x-axis"></div>
          <div class="y-axis"></div>
          <div class="line" style="background:#3b82f6; top:50%; left:10%; width:80%;"></div>
          <div class="point-label" style="top:30%; left:30%; color:#3b82f6; font-size:10px;">y = ¬Ωx + 2</div>
          <div class="point-label" style="top:70%; left:70%; color:#ec4899; font-size:10px;">x - 2y + 4 = 0</div>
          <div class="point-label" style="top:50%; left:50%; color:#10b981; font-size:10px;">Same Line!</div>
        </div>
      </div>

      <div class="example-container">
        <div class="example-box">
          <div class="big">Example: Convert 3x - 6y + 12 = 0 to slope-intercept form</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('form1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="form1">
            <div class="step-line" style="display:none"><b>Step 1:</b> Move x and constant terms: -6y = -3x - 12</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Divide by -6: y = ¬Ωx + 2</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('form1'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Try it</div>
          <div class="try-yourself">
            <div class="try-title">Convert 2x + 4y - 8 = 0 to slope-intercept form</div>
            <div class="row">
              <input id="tform1" placeholder="Type as y=mx+c">
              <button class="check" onclick="checkTextMotivate('tform1','y=-1/2x+2','tform1_res')">Check</button>
            </div>
            <div id="tform1_res" class="result"></div>
          </div>
        </div>
      </div>

      <div class="motivate">
        <div class="emoji">üç´üåà</div>
        <div class="text" style="color:#06D6A0;">Sweet! You're converting line forms like a math wizard! ‚ú®</div>
      </div>

      <!-- Form Conversion Game -->
      <h3 style="margin-top:14px;color:var(--accent)">Play the Form Conversion Game</h3>
      <div class="game-card-grid">
        <div class="game-card-style" onclick="showGame('form-conversion-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #FFD166, #EF476F);">
              <!-- Form conversion SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Line -->
                <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="4" />
                
                <!-- Form 1: General Form -->
                <rect x="5" y="15" width="40" height="20" rx="3" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2" />
                <text x="25" y="28" font-size="8" fill="#3b82f6" text-anchor="middle" font-weight="bold">Ax+By+C=0</text>
                
                <!-- Conversion arrows -->
                <path d="M50 25 L60 25 L60 20 L65 25 L60 30 L60 25" fill="#3b82f6" />
                <path d="M60 25 L70 25 L70 20 L75 25 L70 30 L70 25" fill="#3b82f6" />
                
                <!-- Form 2: Slope-Intercept -->
                <rect x="80" y="15" width="15" height="20" rx="3" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2" />
                <text x="87" y="28" font-size="8" fill="#3b82f6" text-anchor="middle" font-weight="bold">y=mx+c</text>
                
                <!-- Reverse conversion -->
                <path d="M80 40 L70 40 L70 35 L65 40 L70 45 L70 40" fill="#ec4899" />
                <path d="M70 40 L60 40 L60 35 L55 40 L60 45 L60 40" fill="#ec4899" />
                
                <!-- Conversion formula -->
                <text x="50" y="80" font-size="10" fill="#1e40af" text-anchor="middle" font-weight="bold">Rearrange & Solve for y!</text>
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Form Converter</div>
          </div>
          <div>
            <div class="game-card-title">Form Converter</div>
            <div class="game-card-desc">Convert a line equation from General Form to Slope-Intercept Form!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Converting</button></div>
          </div>
        </div>
      </div>

      <div id="form-conversion-game" class="game-play-area">
        <div class="score-board" id="conversion-score-display">Score: 0</div>
        <div class="game-icon-visual"><i class="fas fa-code-branch"></i></div>
        <div class="game-prompt" id="conversion-prompt">Convert: \(3x - 6y + 12 = 0\)</div>
        <div class="game-input-group">
          m: <input type="text" id="m-input" placeholder="Slope (fraction)">
          c: <input type="text" id="c-input" placeholder="Intercept (number)">
        </div>
        <button class="check" onclick="checkConversion()">Submit</button>
        <div class="game-message" id="conversion-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initConversionGame(); playSound('click')">New Problem</button>
      </div>

      <div class="calm">
        <div style="font-size:24px">üß†</div>
        <div style="font-weight:700">Great ‚Äî patience and practice make form conversion simple.</div>
      </div>
    </section>

    <!-- ================= DISTANCE FROM A POINT TO A LINE ================= -->
    <div id="distance" class="divider">4. Distance from a Point to a Line</div>
    <section class="card animate">
      <h2>Finding the Shortest Distance</h2>
      <p class="lead">The shortest distance from a point \(P(x_1, y_1)\) to a line \(Ax + By + C = 0\) is always <strong>perpendicular</strong>. It's the easiest path to the line!</p>

      <div class="definition">
        <div class="definition-content">
          <strong>Distance Formula:</strong> \( d = \frac{|Ax_1 + By_1 + C|}{\sqrt{A^2 + B^2}} \)
          <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:24px">üìè</span>
            <span>The perpendicular distance is always the shortest!</span>
          </div>
        </div>
        <div class="definition-cartoon">
          <!-- Distance to line cartoon -->
          <svg viewBox="0 0 100 100" width="80" height="80" xmlns="http://www.w3.org/2000/svg">
            <!-- Line -->
            <line x1="10" y1="60" x2="90" y2="40" stroke="#3b82f6" stroke-width="3" />
            
            <!-- Point -->
            <circle cx="50" cy="20" r="6" fill="#ec4899" />
            <text x="50" y="15" font-size="6" fill="#ec4899" text-anchor="middle">P</text>
            
            <!-- Perpendicular distance -->
            <line x1="50" y1="20" x2="60" y2="50" stroke="#10b981" stroke-width="3" stroke-dasharray="4,4" />
            
            <!-- Right angle indicator -->
            <path d="M55 45 L60 50 L55 55" stroke="#10b981" stroke-width="2" fill="none" />
            
            <!-- Distance label -->
            <text x="45" y="35" font-size="6" fill="#10b981" text-anchor="middle">d</text>
            
            <!-- Formula -->
            <text x="50" y="80" font-size="7" fill="#1e40af" text-anchor="middle">d = |Ax‚ÇÅ+By‚ÇÅ+C|/‚àö(A¬≤+B¬≤)</text>
          </svg>
        </div>
      </div>

      <!-- Distance Visual -->
      <div class="concept-visual">
        <div class="coordinate-visual">
          <div class="grid-lines"></div>
          <div class="x-axis"></div>
          <div class="y-axis"></div>
          <div class="line" style="background:#3b82f6; top:60%; left:10%; width:80%; transform:rotate(-10deg);"></div>
          <div class="point" style="background:#ec4899; top:30%; left:50%;"></div>
          <div class="point-label" style="top:30%; left:50%; color:#ec4899;">P(5,8)</div>
          <div class="line" style="background:#10b981; top:30%; left:50%; width:2px; height:30%; transform:rotate(90deg);"></div>
          <div class="point-label" style="top:45%; left:55%; color:#10b981; font-size:10px;">d ‚âà 4.2</div>
        </div>
      </div>

      <div class="example-container">
        <div class="example-box">
          <div class="big">Example: Distance from P(6,-1) to line 6x - 4y + 9 = 0</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('dist1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="dist1">
            <div class="step-line" style="display:none"><b>Step 1:</b> Substitute into formula: d = |6(6) - 4(-1) + 9| / ‚àö(6¬≤ + (-4)¬≤)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Calculate numerator: |36 + 4 + 9| = 49</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Calculate denominator: ‚àö(36 + 16) = ‚àö52</div>
            <div class="step-line" style="display:none"><b>Step 4:</b> Final distance: 49/‚àö52 ‚âà 6.79</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('dist1'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Try it</div>
          <div class="try-yourself">
            <div class="try-title">Find distance from P(2,3) to line 3x + 4y - 5 = 0</div>
            <div class="row">
              <input id="tdist1" placeholder="Enter distance">
              <button class="check" onclick="checkTextMotivate('tdist1','2.6','tdist1_res')">Check</button>
            </div>
            <div id="tdist1_res" class="result"></div>
          </div>
        </div>
      </div>

      <div class="motivate">
        <div class="emoji">üß≠üíñ</div>
        <div class="text" style="color:#118AB2;">Incredible! You're calculating distances like a geometry detective! üîç</div>
      </div>

      <!-- Distance Game -->
      <h3 style="margin-top:14px;color:var(--accent)">Play the Distance Game</h3>
      <div class="game-card-grid">
        <div class="game-card-style" onclick="showGame('distance-point-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #06D6A0, #118AB2);">
              <!-- Distance to line SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Line -->
                <line x1="10" y1="60" x2="90" y2="40" stroke="#3b82f6" stroke-width="6" />
                
                <!-- Point -->
                <circle cx="50" cy="20" r="8" fill="#ec4899" />
                <text x="50" y="15" font-size="8" fill="#ec4899" text-anchor="middle" font-weight="bold">P</text>
                
                <!-- Perpendicular distance -->
                <line x1="50" y1="20" x2="60" y2="50" stroke="#10b981" stroke-width="4" stroke-dasharray="6,6" />
                
                <!-- Right angle indicator -->
                <path d="M55 45 L60 50 L55 55" stroke="#10b981" stroke-width="3" fill="none" />
                
                <!-- Distance label -->
                <text x="45" y="35" font-size="8" fill="#10b981" text-anchor="middle" font-weight="bold">d</text>
                
                <!-- Ruler -->
                <rect x="65" y="65" width="25" height="8" rx="2" fill="#FFD166" />
                <line x1="67" y1="67" x2="72" y2="67" stroke="#5D4037" stroke-width="1" />
                <line x1="72" y1="67" x2="77" y2="67" stroke="#5D4037" stroke-width="1" />
                <line x1="77" y1="67" x2="82" y2="67" stroke="#5D4037" stroke-width="1" />
                <line x1="82" y1="67" x2="87" y2="67" stroke="#5D4037" stroke-width="1" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Distance Master</div>
          </div>
          <div>
            <div class="game-card-title">Distance Master</div>
            <div class="game-card-desc">Calculate the shortest distance from a point to a line!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Measuring</button></div>
          </div>
        </div>
      </div>

      <div id="distance-point-game" class="game-play-area">
        <div class="score-board" id="distance-point-score-display">Score: 0</div>
        <div class="game-icon-visual"><i class="fas fa-map-pin"></i></div>
        <div class="game-prompt" id="distance-point-prompt">Point P(6, -1) to Line: \(6x - 4y + 9 = 0\).</div>
        <div class="game-input-group">
          d: <input type="text" id="distance-point-input" placeholder="Distance (e.g., 4.5)">
        </div>
        <button class="check" onclick="checkDistancePoint()">Submit</button>
        <div class="game-message" id="distance-point-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initDistancePointGame(); playSound('click')">New Problem</button>
      </div>

      <div class="calm">
        <div style="font-size:28px">üßò</div>
        <div style="font-weight:700">Nice ‚Äî calculating distances takes practice and you're doing it.</div>
      </div>
    </section>

    <!-- ================= POSITION OF A POINT RELATIVE TO A LINE ================= -->
    <div id="position" class="divider">5. Position of a Point Relative to a Line</div>
    <section class="card animate">
      <h2>Determining if a Point is Above or Below a Line</h2>
      <p class="lead">We use a simple substitution test to see which side of the line a point lies on. <strong>Think of the line as a fence!</strong></p>

      <div class="definition">
        <div class="definition-content">
          <strong>Position Test:</strong> For line \(Ax + By + C = 0\) with \(B > 0\):
          <br>‚Ä¢ Point is <strong>above</strong> if \(Ax_1 + By_1 + C > 0\)
          <br>‚Ä¢ Point is <strong>below</strong> if \(Ax_1 + By_1 + C < 0\)
          <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:24px">üß≠</span>
            <span>Which side of the fence are you on?</span>
          </div>
        </div>
        <div class="definition-cartoon">
          <!-- Point position relative to line cartoon -->
          <svg viewBox="0 0 100 100" width="80" height="80" xmlns="http://www.w3.org/2000/svg">
            <!-- Line -->
            <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="3" />
            
            <!-- Point above -->
            <circle cx="30" cy="30" r="5" fill="#10b981" />
            <text x="30" y="25" font-size="6" fill="#10b981" text-anchor="middle">Above</text>
            <text x="30" y="40" font-size="5" fill="#10b981" text-anchor="middle">Result > 0</text>
            
            <!-- Point below -->
            <circle cx="70" cy="70" r="5" fill="#ec4899" />
            <text x="70" y="65" font-size="6" fill="#ec4899" text-anchor="middle">Below</text>
            <text x="70" y="80" font-size="5" fill="#ec4899" text-anchor="middle">Result < 0</text>
            
            <!-- Arrow indicators -->
            <path d="M30 35 L30 45 L25 45 L30 50 L35 45 L30 45" fill="#10b981" />
            <path d="M70 65 L70 55 L65 55 L70 50 L75 55 L70 55" fill="#ec4899" />
          </svg>
        </div>
      </div>

      <!-- Position Visual -->
      <div class="concept-visual">
        <div class="coordinate-visual">
          <div class="grid-lines"></div>
          <div class="x-axis"></div>
          <div class="y-axis"></div>
          <div class="line" style="background:#3b82f6; top:50%; left:10%; width:80%;"></div>
          <div class="point" style="background:#10b981; top:30%; left:30%;"></div>
          <div class="point-label" style="top:30%; left:30%; color:#10b981;">Above</div>
          <div class="point" style="background:#ec4899; top:70%; left:70%;"></div>
          <div class="point-label" style="top:70%; left:70%; color:#ec4899;">Below</div>
          <div class="point-label" style="top:50%; left:50%; color:#3b82f6; font-size:10px;">Line: Ax+By+C=0</div>
        </div>
      </div>

      <div class="example-container">
        <div class="example-box">
          <div class="big">Example 1: Check position of point P(5,8) relative to line 2x - 3y + 6 = 0</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('pos1'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="pos1">
            <div class="step-line" style="display:none"><b>Step 1 (B > 0):</b> Convert \(2x - 3y + 6 = 0\) to \(-2x + 3y - 6 = 0\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Substitute (5,8): -2(5) + 3(8) - 6 = -10 + 24 - 6 = 8</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Since result is positive (8 > 0), Point lies <strong>above</strong> the line</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('pos1'); playSound('click')">Next Step</button></div>
          </div>
        </div>

        <div class="example-box">
          <div class="big">Example 2: Check if points are on same side</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('pos2'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="pos2">
            <div class="step-line" style="display:none"><b>Step 1 (B > 0):</b> Convert \(6x - 7y + 70 = 0\) to \(-6x + 7y - 70 = 0\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> Substitute (0,0): -6(0) + 7(0) - 70 = -70 < 0</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> Substitute (-4,7): -6(-4) + 7(7) - 70 = 24 + 49 - 70 = 3 > 0</div>
            <div class="step-line" style="display:none"><b>Step 4:</b> Since signs are different, points lie on <strong>opposite sides</strong>.</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('pos2'); playSound('click')">Next Step</button></div>
          </div>
        </div>
        
        <div class="example-box">
          <div class="big">Example 3: Check position of multiple points</div>
          <div class="controls">
            <button class="step-btn" onclick="startSteps('pos3'); playSound('concept')">Show Steps</button>
          </div>
          <div class="step-block" id="pos3">
            <div class="step-line" style="display:none"><b>Step 1 (B > 0):</b> Convert \(x - 2y + 3 = 0\) to \(-x + 2y - 3 = 0\)</div>
            <div class="step-line" style="display:none"><b>Step 2:</b> (1,1) gives -2 < 0 (Below)</div>
            <div class="step-line" style="display:none"><b>Step 3:</b> (2,3) gives 1 > 0 (Above)</div>
            <div style="margin-top:8px"><button class="next-step" onclick="nextStep('pos3'); playSound('click')">Next Step</button></div>
          </div>
        </div>
      </div>

      <div class="try-yourself">
        <div class="try-title">‚ú® Try It Yourself</div>
        <p>Is point P(1,1) above or below the line x - 2y + 3 = 0?</p>
        <div class="row">
          <button class="check" onclick="alert('Below ‚Äî the result is -2 < 0'); playSound('success')">ABOVE</button>
          <button class="check" style="background:#ef4444" onclick="alert('Correct! The result is -2 < 0'); playSound('success')">BELOW</button>
        </div>
      </div>

      <div class="motivate">
        <div class="emoji">üß≠üíñ</div>
        <div class="text" style="color:#118AB2;">Fantastic! You're positioning points like a navigation expert! üß≠</div>
      </div>

      <!-- Position Game -->
      <h3 style="margin-top:14px;color:var(--accent)">Play the Position Game</h3>
      <div class="game-card-grid">
        <div class="game-card-style" onclick="showGame('position-classifier-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" aria-hidden="true" style="background: linear-gradient(135deg, #06D6A0, #118AB2);">
              <!-- Position classifier SVG -->
              <svg viewBox="0 0 100 100" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <!-- Line -->
                <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="6" />
                
                <!-- Point above -->
                <circle cx="30" cy="30" r="8" fill="#10b981" />
                <text x="30" y="25" font-size="8" fill="#10b981" text-anchor="middle" font-weight="bold">Above</text>
                <text x="30" y="40" font-size="7" fill="#10b981" text-anchor="middle">Result > 0</text>
                
                <!-- Point below -->
                <circle cx="70" cy="70" r="8" fill="#ec4899" />
                <text x="70" y="65" font-size="8" fill="#ec4899" text-anchor="middle" font-weight="bold">Below</text>
                <text x="70" y="80" font-size="7" fill="#ec4899" text-anchor="middle">Result < 0</text>
                
                <!-- Arrow indicators -->
                <path d="M30 35 L30 45 L25 45 L30 50 L35 45 L30 45" fill="#10b981" stroke-width="2" />
                <path d="M70 65 L70 55 L65 55 L70 50 L75 55 L70 55" fill="#ec4899" stroke-width="2" />
                
                <!-- Balance scale -->
                <line x1="45" y1="20" x2="55" y2="20" stroke="#5D4037" stroke-width="3" />
                <line x1="50" y1="20" x2="50" y2="30" stroke="#5D4037" stroke-width="3" />
                <path d="M40 30 L60 30 L55 40 L45 40 Z" fill="#FFD166" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Position Classifier</div>
          </div>
          <div>
            <div class="game-card-title">Position Classifier</div>
            <div class="game-card-desc">Determine if a point is 'Above' or 'Below' the given line!</div>
            <div style="margin-top:12px"><button class="start-btn">Start Classifying</button></div>
          </div>
        </div>
      </div>

      <div id="position-classifier-game" class="game-play-area">
        <div class="score-board" id="position-score-display">Score: 0</div>
        <div class="game-icon-visual"><i class="fas fa-balance-scale"></i></div>
        <div class="game-prompt" id="position-prompt">Point P(5, 8) to Line: \(2x - 3y + 6 = 0\).</div>
        <div class="game-input-group">
          <button class="check" onclick="checkPosition('above')">ABOVE (Result > 0)</button>
          <button class="check" style="background:#ef4444" onclick="checkPosition('below')">BELOW (Result < 0)</button>
        </div>
        <div class="game-message" id="position-status">Ready.</div>
        <button class="step-btn" style="margin-top: 15px;" onclick="initPositionGame(); playSound('click')">New Check</button>
      </div>

      <div class="calm">
        <div style="font-size:28px">üßò</div>
        <div style="font-weight:700">Excellent ‚Äî recognizing positions takes practice and you're mastering it.</div>
      </div>
    </section>

    <!-- GAMES landing -->
    <div id="games" class="divider">Stress-Relief Games</div>
    <section class="card">
      <h2>Quick Access to Games</h2>
      <p class="lead">Click any game below to open it ‚Äî each has a cute cartoon illustration to help identify it.</p>
      <div class="game-card-grid">
        <div class="game-card-style" onclick="showGame('slope-shooter-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #ff7eb3, #ff758c);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Mountain slope -->
                <path d="M10 80 L50 20 L90 80 Z" fill="#8B9D83" />
                <line x1="30" y1="70" x2="70" y2="70" stroke="#5D4037" stroke-width="3" />
                <line x1="30" y1="70" x2="50" y2="30" stroke="#5D4037" stroke-width="3" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Mountain Adventure</div>
          </div>
          <div>
            <div class="game-card-title">Slope Calculator</div>
            <div class="game-card-desc">Practice slope problems and aim for high score.</div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('collinearity-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #65C7F7, #4ECDC4);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Collinear points -->
                <line x1="15" y1="50" x2="85" y2="50" stroke="#4ECDC4" stroke-width="8" stroke-linecap="round" />
                <circle cx="25" cy="50" r="8" fill="#EF476F" />
                <circle cx="50" cy="50" r="8" fill="#FFD166" />
                <circle cx="75" cy="50" r="8" fill="#06D6A0" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Alignment Check</div>
          </div>
          <div>
            <div class="game-card-title">Slope Spotter</div>
            <div class="game-card-desc">Check if points align on a straight line.</div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('parallel-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #FFD166, #EF476F);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Parallel lines -->
                <line x1="10" y1="30" x2="90" y2="30" stroke="#3b82f6" stroke-width="6" />
                <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="6" />
                <line x1="10" y1="70" x2="90" y2="70" stroke="#3b82f6" stroke-width="6" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Parallel Finder</div>
          </div>
          <div>
            <div class="game-card-title">Parallel Finder</div>
            <div class="game-card-desc">Find the unknown coefficient for parallel lines.</div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('perpendicular-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #06D6A0, #118AB2);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Perpendicular lines -->
                <line x1="30" y1="70" x2="70" y2="70" stroke="#ec4899" stroke-width="6" />
                <line x1="50" y1="50" x2="50" y2="90" stroke="#ec4899" stroke-width="6" />
                <path d="M45 70 L50 70 L50 75" stroke="#ec4899" stroke-width="3" fill="none" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Perpendicular Solver</div>
          </div>
          <div>
            <div class="game-card-title">Perpendicular Solver</div>
            <div class="game-card-desc">Find the unknown coefficient for perpendicular lines.</div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('form-conversion-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #FFD166, #EF476F);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Form conversion -->
                <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="4" />
                <rect x="5" y="15" width="40" height="20" rx="3" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2" />
                <text x="25" y="28" font-size="8" fill="#3b82f6" text-anchor="middle" font-weight="bold">Ax+By+C=0</text>
                <path d="M50 25 L70 25 L70 20 L75 25 L70 30 L70 25" fill="#3b82f6" />
                <rect x="80" y="15" width="15" height="20" rx="3" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2" />
                <text x="87" y="28" font-size="8" fill="#3b82f6" text-anchor="middle" font-weight="bold">y=mx+c</text>
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Form Converter</div>
          </div>
          <div>
            <div class="game-card-title">Form Converter</div>
            <div class="game-card-desc">Convert between different line equation forms.</div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('distance-point-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #06D6A0, #118AB2);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Distance to line -->
                <line x1="10" y1="60" x2="90" y2="40" stroke="#3b82f6" stroke-width="6" />
                <circle cx="50" cy="20" r="8" fill="#ec4899" />
                <line x1="50" y1="20" x2="60" y2="50" stroke="#10b981" stroke-width="4" stroke-dasharray="6,6" />
                <path d="M55 45 L60 50 L55 55" stroke="#10b981" stroke-width="3" fill="none" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Distance Master</div>
          </div>
          <div>
            <div class="game-card-title">Distance Master</div>
            <div class="game-card-desc">Calculate distances from points to lines.</div>
          </div>
        </div>

        <div class="game-card-style" onclick="showGame('position-classifier-game'); playSound('gameStart')">
          <div class="game-card-left">
            <div class="svg-icon" style="background: linear-gradient(135deg, #06D6A0, #118AB2);">
              <svg viewBox="0 0 100 100" width="100" height="100">
                <!-- Position classifier -->
                <line x1="10" y1="50" x2="90" y2="50" stroke="#3b82f6" stroke-width="6" />
                <circle cx="30" cy="30" r="8" fill="#10b981" />
                <circle cx="70" cy="70" r="8" fill="#ec4899" />
                <path d="M30 35 L30 45 L25 45 L30 50 L35 45 L30 45" fill="#10b981" stroke-width="2" />
                <path d="M70 65 L70 55 L65 55 L70 50 L75 55 L70 55" fill="#ec4899" stroke-width="2" />
              </svg>
            </div>
            <div style="font-size:12px;color:var(--muted); margin-top:5px">Position Classifier</div>
          </div>
          <div>
            <div class="game-card-title">Position Classifier</div>
            <div class="game-card-desc">Determine if points are above or below lines.</div>
          </div>
        </div>
      </div>
    </section>

   <div style="text-align: center; margin: 40px 0;">
    <a href="{{ url_for('serve_chapter_part', chapter_num=4, part_num=4) }}" class="btn btn-primary">
        Continue to Part 4 <i class="fas fa-arrow-right"></i>
    </a>
</div>
    </div>
  </div>

  <!-- Floating quick games button -->
  <div class="fab">
    <i class="fas fa-gamepad"></i>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-about">
          <div class="footer-logo">
            <div class="footer-logo-icon">S</div>
            Sentellect
          </div>
          <p>Personalizing learning through emotions to improve educational experience for HSSC Mathematics.</p>
          <div class="social-links">
            <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
            <!-- Sound control removed from here -->
            <a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
        
        <div class="footer-links">
          <h3>Platform</h3>
          <ul>
            <li><a href="#slope">Slope & Collinearity</a></li>
            <li><a href="#parallel">Parallel & Perpendicular</a></li>
            <li><a href="#forms">Line Equations</a></li>
            <li><a href="#distance">Distance</a></li>
            <li><a href="#position">Position</a></li>
          </ul>
        </div>
        
        <div class="footer-links">
          <h3>Resources</h3>
          <ul>
            <li><a href="#">Study Materials</a></li>
            <li><a href="#">About Project</a></li>
            <li><a href="#">Contact</a></li>
            <li><a href="#">Support</a></li>
          </ul>
        </div>
        
        <div class="footer-links">
          <h3>Account</h3>
          <ul>
            <li><a href="#">Student Login</a></li>
            <li><a href="#">Create Account</a></li>
            <li><a href="#">Help Center</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>¬© 2025 Sentellect. Final Year Project - Educational Technology.</p>
        <div class="footer-tags">
          <a href="#" class="tag">PTB HSSC Mathematics</a>
          <a href="#" class="tag">Emotion-Aware Learning</a>
          <a href="#" class="tag">Coordinate Geometry</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- ================= JS: games + UI functions ================= -->
  <script>
    // Celebration system
    function celebrate() {
      if (!soundEnabled) return;
      
      const celebration = document.getElementById('celebration');
      celebration.style.display = 'block';
      
      // Play celebration sound
      playSound('celebration');
      
      // Create confetti
      for (let i = 0; i < 150; i++) {
        createConfetti();
      }
      
      // Create party poppers
      for (let i = 0; i < 20; i++) {
        createPartyPopper();
      }
      
      // Create hurray text
      createHurrayText();
      
      // Hide celebration after 3 seconds
      setTimeout(() => {
        celebration.style.display = 'none';
        celebration.innerHTML = '';
      }, 3000);
    }
    
    function createConfetti() {
      const celebration = document.getElementById('celebration');
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      
      // Random position
      const left = Math.random() * 100;
      const colors = ['#ff6b6b', '#ffd166', '#06d6a0', '#118ab2', '#ef476f'];
      const color = colors[Math.floor(Math.random() * colors.length)];
      
      confetti.style.left = `${left}%`;
      confetti.style.backgroundColor = color;
      
      celebration.appendChild(confetti);
      
      // Animate confetti
      const animation = confetti.animate([
        { transform: 'translateY(-20px) rotate(0deg)', opacity: 1 },
        { transform: `translateY(${window.innerHeight}px) rotate(720deg)`, opacity: 0 }
      ], {
        duration: 2000 + Math.random() * 1000,
        easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
      });
      
      animation.onfinish = () => {
        confetti.remove();
      };
    }
    
    function createPartyPopper() {
      const celebration = document.getElementById('celebration');
      const popper = document.createElement('div');
      popper.className = 'party-popper';
      popper.textContent = 'üéâ';
      
      // Random position
      const left = Math.random() * 100;
      const top = Math.random() * 100;
      
      popper.style.left = `${left}%`;
      popper.style.top = `${top}%`;
      
      celebration.appendChild(popper);
      
      // Animate party popper
      const animation = popper.animate([
        { transform: 'scale(0) rotate(0deg)', opacity: 1 },
        { transform: 'scale(1.5) rotate(360deg)', opacity: 0 }
      ], {
        duration: 1000 + Math.random() * 500,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      });
      
      animation.onfinish = () => {
        popper.remove();
      };
    }
    
    function createHurrayText() {
      const celebration = document.getElementById('celebration');
      const hurray = document.createElement('div');
      hurray.className = 'hurray-text';
      hurray.textContent = 'HURRAY!';
      
      celebration.appendChild(hurray);
      
      // Animate hurray text
      const animation = hurray.animate([
        { transform: 'translate(-50%, -50%) scale(0)', opacity: 0 },
        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(1.2)', opacity: 0 }
      ], {
        duration: 3000,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      });
      
      animation.onfinish = () => {
        hurray.remove();
      };
    }

    // Sound system
    let soundEnabled = true;
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
    // Sound functions
    function playSound(type) {
      if (!soundEnabled) return;
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      // Set sound parameters based on type
      switch(type) {
        case 'success':
          oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
          oscillator.start();
          oscillator.stop(audioContext.currentTime + 0.5);
          break;
          
        case 'error':
          oscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
          oscillator.start();
          oscillator.stop(audioContext.currentTime + 0.3);
          break;
          
        case 'click':
          oscillator.frequency.setValueAtTime(784, audioContext.currentTime); // G5
          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
          oscillator.start();
          oscillator.stop(audioContext.currentTime + 0.1);
          break;
          
        case 'gameStart':
          // Play a little melody
          playMelody([784, 659, 523, 659, 784], [0.15, 0.15, 0.15, 0.15, 0.3]);
          break;
          
        case 'celebration':
          // Play a celebratory melody
          playMelody([523.25, 659.25, 783.99, 1046.50, 1318.51, 1567.98], [0.15, 0.15, 0.15, 0.15, 0.15, 0.5]);
          break;
          
        case 'concept':
          // Play a gentle sound for understanding concepts
          playMelody([261.63, 329.63, 392.00], [0.3, 0.3, 0.5]);
          break;
      }
    }
    
    function playMelody(frequencies, durations) {
      let time = audioContext.currentTime;
      
      frequencies.forEach((freq, i) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, time);
        gainNode.gain.setValueAtTime(0.2, time);
        gainNode.gain.exponentialRampToValueAtTime(0.01, time + durations[i]);
        
        oscillator.start(time);
        oscillator.stop(time + durations[i]);
        
        time += durations[i];
      });
    }
    
    // Toggle sound
    document.getElementById('toggleSound').addEventListener('click', function() {
      soundEnabled = !soundEnabled;
      const icon = this.querySelector('i');
      
      if (soundEnabled) {
        icon.className = 'fas fa-volume-up';
        this.classList.remove('muted');
        playSound('click');
      } else {
        icon.className = 'fas fa-volume-mute';
        this.classList.add('muted');
      }
    });

    /* -------- Helpers (step reveals & answer checking) -------- */
    function startSteps(blockId){
      const block = document.getElementById(blockId);
      if(!block) return;
      const lines = block.querySelectorAll('.step-line');
      lines.forEach(l => l.style.display = 'none');
      if(lines.length) lines[0].style.display = 'block';
      playSound('concept');
    }
    
    function nextStep(blockId){
      const block = document.getElementById(blockId);
      if(!block) return;
      const lines = block.querySelectorAll('.step-line');
      let shown = 0;
      for(let i=0;i<lines.length;i++) if(getComputedStyle(lines[i]).display !== 'none') shown++;
      if(shown < lines.length) {
        lines[shown].style.display = 'block';
        playSound('success');
        // Celebrate on the last step
        if (shown === lines.length - 1) {
          setTimeout(celebrate, 500);
        }
      }
    }

    function checkTextMotivate(inputId, correctText, resultId){
      const val = (document.getElementById(inputId).value || '').trim().toLowerCase().replace(/\s/g,'');
      const correct = (''+correctText).trim().toLowerCase().replace(/\s/g,'');
      const resEl = document.getElementById(resultId);
      if(!resEl){
        // create a simple inline feedback if result element missing
        const el = document.createElement('div'); el.style.marginTop='8px';
        if(val === correct){ 
          el.style.color='#047857'; 
          el.textContent='Nice! Correct ‚úÖ';
          playSound('success');
          celebrate();
        } else { 
          el.style.color='#92400e'; 
          el.textContent='Not quite ‚Äî try again.';
          playSound('error');
        }
        document.getElementById(inputId).insertAdjacentElement('afterend', el);
        return;
      }
      if(val === correct){
        resEl.style.color = '#047857'; 
        resEl.textContent = 'Nice! Correct ‚úÖ';
        resEl.className = "result good";
        playSound('success');
        celebrate();
      } else {
        resEl.style.color = '#92400e'; 
        resEl.textContent = 'Not quite ‚Äî try again.';
        resEl.className = "result warn";
        playSound('error');
      }
      resEl.style.display = "block";
    }

    /* ---------- Game datasets ---------- */
    const slopeData = [
      { p1: [2, 4], p2: [5, 13], m: 3 }, 
      { p1: [-1, -3], p2: [2, 3], m: 2 }, 
      { p1: [7, 1], p2: [1, 7], m: -1 }, 
      { p1: [0, 5], p2: [10, 0], m: -0.5 }
    ];

    const collinearData = [
      { id: 1, a_coords: [1, 2], b_coords: [3, 4], c_coords: [5, 6], text: 'A(1, 2), B(3, 4), C(5, 6)' },
      { id: 2, a_coords: [0, 0], b_coords: [2, 1], c_coords: [4, 3], text: 'A(0, 0), B(2, 1), C(4, 3)' },
      { id: 3, a_coords: [-1, 1], b_coords: [3, 2], c_coords: [7, 3], text: 'A(-1, 1), B(3, 2), C(7, 3)' },
      { id: 4, a_coords: [1, 1], b_coords: [2, 5], c_coords: [3, 9], text: 'A(1, 1), B(2, 5), C(3, 9)' },
      { id: 5, a_coords: [1, 1], b_coords: [1, 5], c_coords: [2, 10], text: 'A(1, 1), B(1, 5), C(2, 10)' }
    ];

    const parallelPerpData = {
      commonPoints: { A: [7, 3], B: 'k', B_y: -6, C: [-4, 5], D: [-6, 4] },
      parallelK: -11, 
      perpendicularK: 11.5
    };

    const conversionData = [
      { eq: '3x - 6y + 12 = 0', m_ans: '1/2', c_ans: '2' },
      { eq: '2x + 4y - 8 = 0', m_ans: '-1/2', c_ans: '2' },
      { eq: '5x - 5y - 15 = 0', m_ans: '1', c_ans: '-3' }
    ];

    const distancePointData = [
      { p: [6, -1], a: 6, b: -4, c: 9, ans: 49 / Math.sqrt(52) },
      { p: [2, 3], a: 3, b: 4, c: -5, ans: 13 / 5 },
      { p: [0, 0], a: 3, b: 4, c: -10, ans: 2 }
    ];

    const positionData = [
      { p: [5, 8], eq_a: 2, eq_b: -3, eq_c: 6, correct_pos: 'above' }, 
      { p: [0, 0], eq_a: 6, eq_b: -7, eq_c: 70, correct_pos: 'below' }, 
      { p: [1, 1], eq_a: 1, eq_b: -2, eq_c: 3, correct_pos: 'below' }, 
      { p: [4, 1], eq_a: 5, eq_b: 2, eq_c: -10, correct_pos: 'above' }
    ];

    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr }

    function calculateSlope(p1,p2){
      const dy = p2[1] - p1[1];
      const dx = p2[0] - p1[0];
      if(dx === 0) return Infinity;
      return dy / dx;
    }
    
    function isCollinear(a,b,c){
      const s1 = calculateSlope(a,b);
      const s2 = calculateSlope(b,c);
      if(s1 === Infinity && s2 === Infinity) return true;
      if(s1 === Infinity || s2 === Infinity) return false;
      return Math.abs(s1 - s2) < 1e-9;
    }
    
    function normalizeFraction(str) {
      str = String(str).replace(/\s/g, '').toLowerCase();
      if (str.includes('/')) {
        const parts = str.split('/');
        const num = parseFloat(parts[0]);
        const den = parseFloat(parts[1]);
        return num / den;
      }
      return parseFloat(str);
    }

    /* ---------------- Slope Calculator ---------------- */
    let slopeScore = 0;
    let currentSlopeProblem = null;

    function initSlopeGame(){
      const problem = slopeData[Math.floor(Math.random() * slopeData.length)];
      currentSlopeProblem = problem;
      
      document.getElementById('slope-prompt').textContent = `Points: (${problem.p1}) and (${problem.p2})`;
      document.getElementById('slope-m-input').value = '';
      document.getElementById('slope-status').textContent = `Score: ${slopeScore}`;
      document.getElementById('slope-score-display').textContent = `Score: ${slopeScore}`;
      document.getElementById('slope-status').classList.remove('success', 'wrong');
    }

    function checkSlope(){
      const userM = normalizeFraction(document.getElementById('slope-m-input').value);
      if (isNaN(userM)) { document.getElementById('slope-status').textContent = 'Enter a valid number/fraction.'; playSound('error'); return; }
      
      const correctM = currentSlopeProblem.m;

      if (Math.abs(userM - correctM) < 1e-9) {
        slopeScore++;
        document.getElementById('slope-status').className = 'game-message success';
        document.getElementById('slope-status').textContent = `Correct! m = ${correctM}. Score: ${slopeScore}.`;
        document.getElementById('slope-score-display').textContent = `Score: ${slopeScore}`;
        playSound('success');
        celebrate();
        setTimeout(initSlopeGame, 1500);
      } else {
        slopeScore = Math.max(0, slopeScore - 1);
        document.getElementById('slope-status').className = 'game-message wrong';
        document.getElementById('slope-status').textContent = `Incorrect. Remember: Rise over Run! Score: ${slopeScore}.`;
        document.getElementById('slope-score-display').textContent = `Score: ${slopeScore}`;
        playSound('error');
      }
    }

    /* ---------------- Collinearity Slope Spotter ---------------- */
    let collinearityScore = 0;
    let currentCollinearityProblem = null;

    function initCollinearityGame() {
      const problem = collinearData[Math.floor(Math.random() * collinearData.length)];
      currentCollinearityProblem = problem;
      
      const correctCollinearity = isCollinear(problem.a_coords, problem.b_coords, problem.c_coords);
      problem.correct_answer = correctCollinearity; 

      document.getElementById('collinearity-prompt').textContent = problem.text;
      document.getElementById('collinearity-status').textContent = `Score: ${collinearityScore}`;
      document.getElementById('collinearity-score-display').textContent = `Score: ${collinearityScore}`;
      document.getElementById('collinearity-status').classList.remove('success', 'wrong');
    }

    function checkCollinearity(userGuess) {
      const problem = currentCollinearityProblem;
      const correct = problem.correct_answer;

      if (userGuess === correct) {
        collinearityScore++;
        document.getElementById('collinearity-status').className = 'game-message success';
        document.getElementById('collinearity-status').textContent = `Correct! Slopes matched! Score: ${collinearityScore}.`;
        document.getElementById('collinearity-score-display').textContent = `Score: ${collinearityScore}`;
        playSound('success');
        celebrate();
        setTimeout(initCollinearityGame, 1500);
      } else {
        collinearityScore = Math.max(0, collinearityScore - 1);
        document.getElementById('collinearity-status').className = 'game-message wrong';
        document.getElementById('collinearity-status').textContent = `Not quite. Rerun the slope calculation! Score: ${collinearityScore}`;
        document.getElementById('collinearity-score-display').textContent = `Score: ${collinearityScore}`;
        playSound('error');
      }
    }

    /* ---------------- Parallel Finder ---------------- */
    let parallelScore = 0;
    let currentParallelProblem = null;

    function initParallelGame() {
      const A = parallelPerpData.commonPoints.A;
      const B_k = parallelPerpData.commonPoints.B;
      const C = parallelPerpData.commonPoints.C;
      const D = parallelPerpData.commonPoints.D;

      currentParallelProblem = { correctK: parallelPerpData.parallelK };
      
      document.getElementById('parallel-prompt').textContent = `Line 1: (${A[0]}, ${A[1]}) to (${B_k}, ${parallelPerpData.commonPoints.B_y || -6}). Line 2: (${C[0]}, ${C[1]}) to (${D[0]}, ${D[1]}).`;
      document.getElementById('parallel-k-input').value = '';
      document.getElementById('parallel-status').textContent = `Score: ${parallelScore}`;
      document.getElementById('parallel-score-display').textContent = `Score: ${parallelScore}`;
      document.getElementById('parallel-status').classList.remove('success', 'wrong');
    }

    function checkParallel() {
      const userK = parseFloat(document.getElementById('parallel-k-input').value);
      const correctK = currentParallelProblem.correctK;

      if (Math.abs(userK - correctK) < 1e-9) {
        parallelScore++;
        document.getElementById('parallel-status').className = 'game-message success';
        document.getElementById('parallel-status').textContent = `Correct! k = ${correctK}. Score: ${parallelScore}.`;
        document.getElementById('parallel-score-display').textContent = `Score: ${parallelScore}`;
        playSound('success');
        celebrate();
        setTimeout(initParallelGame, 1500);
      } else {
        parallelScore = Math.max(0, parallelScore - 1);
        document.getElementById('parallel-status').className = 'game-message wrong';
        document.getElementById('parallel-status').textContent = `Incorrect. Remember: m1 = m2. Score: ${parallelScore}.`;
        document.getElementById('parallel-score-display').textContent = `Score: ${parallelScore}`;
        playSound('error');
      }
    }
    /* ==========================================
   SCROLL SPEED DETECTOR (Anxiety Check)
   ========================================== */

let lastScrollTop = 0;
let fastScrollCount = 0;
let scrollAlertShown = false; // To prevent spamming the popup

// Check scroll speed every 200ms
setInterval(() => {
    if (scrollAlertShown) return; // Stop checking if we already showed the modal

    // Get current scroll position
    const st = window.pageYOffset || document.documentElement.scrollTop;
    
    // Calculate distance moved in last 200ms
    const distance = Math.abs(st - lastScrollTop);
    
    // Threshold: If moved more than 300px in 0.2 seconds (Very Fast)
    if (distance > 300) {
        fastScrollCount++;
        console.log("‚ö†Ô∏è Fast Scroll Detected:", fastScrollCount);
    } else {
        // Decay counter (if they slow down, forgive them)
        if (fastScrollCount > 0) fastScrollCount--;
    }

    // Trigger: If they speed-scroll 4 times consecutively
    if (fastScrollCount >= 4) {
        showScrollModal();
        fastScrollCount = 0; // Reset
    }

    lastScrollTop = st;
}, 200); 

function showScrollModal() {
    const modal = document.getElementById('scrollModal');
    if (modal) {
        modal.style.display = 'flex';
        scrollAlertShown = true; // Ensure it only pops up once per session
        
        // Optional: Log to backend
        if(typeof fetch !== 'undefined') {
            fetch('/api/log_behavior', { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ reason: 'rapid_scrolling', context: 'high_stress_chapter2' }) 
            }).catch(e => console.log(e));
        }
    }
}

function closeScrollModal() {
    document.getElementById('scrollModal').style.display = 'none';
    // scrollAlertShown remains true so we don't bug them again
}

    /* ---------------- Perpendicular Solver ---------------- */
    let perpendicularScore = 0;
    let currentPerpendicularProblem = null;

    function initPerpendicularGame() {
      const A = parallelPerpData.commonPoints.A;
      const B_k = parallelPerpData.commonPoints.B;
      const C = parallelPerpData.commonPoints.C;
      const D = parallelPerpData.commonPoints.D;

      currentPerpendicularProblem = { correctK: parallelPerpData.perpendicularK };
      
      document.getElementById('perpendicular-prompt').textContent = `Line 1: (${A[0]}, ${A[1]}) to (${B_k}, ${parallelPerpData.commonPoints.B_y || -6}). Line 2: (${C[0]}, ${C[1]}) to (${D[0]}, ${D[1]}).`;
      document.getElementById('perpendicular-k-input').value = '';
      document.getElementById('perpendicular-status').textContent = `Score: ${perpendicularScore}`;
      document.getElementById('perpendicular-score-display').textContent = `Score: ${perpendicularScore}`;
      document.getElementById('perpendicular-status').classList.remove('success', 'wrong');
    }

    function checkPerpendicular() {
      const userK = parseFloat(document.getElementById('perpendicular-k-input').value);
      const correctK = currentPerpendicularProblem.correctK;

      if (Math.abs(userK - correctK) < 1e-9) {
        perpendicularScore++;
        document.getElementById('perpendicular-status').className = 'game-message success';
        document.getElementById('perpendicular-status').textContent = `Correct! k = ${correctK}. Score: ${perpendicularScore}.`;
        document.getElementById('perpendicular-score-display').textContent = `Score: ${perpendicularScore}`;
        playSound('success');
        celebrate();
        setTimeout(initPerpendicularGame, 1500);
      } else {
        perpendicularScore = Math.max(0, perpendicularScore - 1);
        document.getElementById('perpendicular-status').className = 'game-message wrong';
        document.getElementById('perpendicular-status').textContent = `Incorrect. Remember: m1 * m2 = -1. Score: ${perpendicularScore}.`;
        document.getElementById('perpendicular-score-display').textContent = `Score: ${perpendicularScore}`;
        playSound('error');
      }
    }

    /* ---------------- Form Converter ---------------- */
    let conversionScore = 0;
    let currentConversionProblem = null;

    function initConversionGame() {
      const problem = conversionData[Math.floor(Math.random() * conversionData.length)];
      currentConversionProblem = problem;
      
      document.getElementById('conversion-prompt').textContent = `Convert: ${problem.eq}`;
      document.getElementById('m-input').value = '';
      document.getElementById('c-input').value = '';
      document.getElementById('conversion-status').textContent = `Score: ${conversionScore}`;
      document.getElementById('conversion-score-display').textContent = `Score: ${conversionScore}`;
      document.getElementById('conversion-status').classList.remove('success', 'wrong');
    }

    function checkConversion() {
      const userM = normalizeFraction(document.getElementById('m-input').value);
      const userC = parseFloat(document.getElementById('c-input').value);
      
      const correctM = normalizeFraction(currentConversionProblem.m_ans);
      const correctC = parseFloat(currentConversionProblem.c_ans);

      if (Math.abs(userM - correctM) < 1e-9 && Math.abs(userC - correctC) < 1e-9) {
        conversionScore++;
        document.getElementById('conversion-status').className = 'game-message success';
        document.getElementById('conversion-status').textContent = `Correct! y = ${currentConversionProblem.m_ans}x + ${currentConversionProblem.c_ans}. Score: ${conversionScore}.`;
        document.getElementById('conversion-score-display').textContent = `Score: ${conversionScore}`;
        playSound('success');
        celebrate();
        setTimeout(initConversionGame, 1500);
      } else {
        conversionScore = Math.max(0, conversionScore - 1);
        document.getElementById('conversion-status').className = 'game-message wrong';
        document.getElementById('conversion-status').textContent = `Incorrect. Isolate y! Score: ${conversionScore}.`;
        document.getElementById('conversion-score-display').textContent = `Score: ${conversionScore}`;
        playSound('error');
      }
    }

    /* ---------------- Distance Master ---------------- */
    let distancePointScore = 0;
    let currentDistancePointProblem = null;

    function initDistancePointGame() {
      const problem = distancePointData[Math.floor(Math.random() * distancePointData.length)];
      currentDistancePointProblem = problem;

      document.getElementById('distance-point-prompt').textContent = `Point P(${problem.p[0]}, ${problem.p[1]}) to Line: ${problem.a}x + ${problem.b}y + ${problem.c} = 0.`;
      document.getElementById('distance-point-input').value = '';
      document.getElementById('distance-point-status').textContent = `Score: ${distancePointScore}`;
      document.getElementById('distance-point-score-display').textContent = `Score: ${distancePointScore}`;
      document.getElementById('distance-point-status').classList.remove('success', 'wrong');
    }

    function checkDistancePoint() {
      const userD = normalizeFraction(document.getElementById('distance-point-input').value);
      const correctD = currentDistancePointProblem.ans;
      
      if (Math.abs(userD - correctD) < 1e-9) {
        distancePointScore++;
        document.getElementById('distance-point-status').className = 'game-message success';
        document.getElementById('distance-point-status').textContent = `Correct! d = ${correctD.toFixed(2)}. Score: ${distancePointScore}.`;
        document.getElementById('distance-point-score-display').textContent = `Score: ${distancePointScore}`;
        playSound('success');
        celebrate();
        setTimeout(initDistancePointGame, 1500);
      } else {
        distancePointScore = Math.max(0, distancePointScore - 1);
        document.getElementById('distance-point-status').className = 'game-message wrong';
        document.getElementById('distance-point-status').textContent = `Incorrect. Remember: |Ax+By+C| / sqrt(A¬≤+B¬≤)! Score: ${distancePointScore}.`;
        document.getElementById('distance-point-score-display').textContent = `Score: ${distancePointScore}`;
        playSound('error');
      }
    }

    /* ---------------- Position Classifier ---------------- */
    let positionScore = 0;
    let currentPositionProblem = null;

    function initPositionGame() {
      const problem = positionData[Math.floor(Math.random() * positionData.length)];
      currentPositionProblem = problem;

      // Step 1: Normalize equation to B > 0
      let A = problem.eq_a;
      let B = problem.eq_b;
      let C = problem.eq_c;
      
      if (B < 0) {
        A *= -1;
        B *= -1;
        C *= -1;
      }

      const testValue = A * problem.p[0] + B * problem.p[1] + C;
      
      problem.correct_answer = testValue > 0 ? 'above' : 'below';

      document.getElementById('position-prompt').textContent = `Point P(${problem.p}) to Line: ${problem.eq_a}x + ${problem.eq_b}y + ${problem.eq_c} = 0.`;
      document.getElementById('position-status').textContent = `Score: ${positionScore}`;
      document.getElementById('position-score-display').textContent = `Score: ${positionScore}`;
      document.getElementById('position-status').classList.remove('success', 'wrong');
    }

    function checkPosition(userGuess) {
      const correct = currentPositionProblem.correct_answer;

      if (userGuess === correct) {
        positionScore++;
        document.getElementById('position-status').className = 'game-message success';
        document.getElementById('position-status').textContent = `Correct! The point is ${correct}. Score: ${positionScore}.`;
        document.getElementById('position-score-display').textContent = `Score: ${positionScore}`;
        playSound('success');
        celebrate();
        setTimeout(initPositionGame, 1500);
      } else {
        positionScore = Math.max(0, positionScore - 1);
        document.getElementById('position-status').className = 'game-message wrong';
        document.getElementById('position-status').textContent = `Incorrect. Remember: B > 0, then check the sign! Score: ${positionScore}.`;
        document.getElementById('position-score-display').textContent = `Score: ${positionScore}`;
        playSound('error');
      }
    }

    /* ---------- show/hide game area helper ---------- */
    function showGame(gameId){
      document.querySelectorAll('.game-play-area').forEach(e => e.style.display = 'none');
      const area = document.getElementById(gameId);
      if(area){ 
        area.style.display = 'block'; 
        area.scrollIntoView({behavior:'smooth', block:'center'}); 
      }
      if(gameId === 'slope-shooter-game') initSlopeGame();
      if(gameId === 'collinearity-game') initCollinearityGame();
      if(gameId === 'parallel-game') initParallelGame();
      if(gameId === 'perpendicular-game') initPerpendicularGame();
      if(gameId === 'form-conversion-game') initConversionGame();
      if(gameId === 'distance-point-game') initDistancePointGame();
      if(gameId === 'position-classifier-game') initPositionGame();
    }

    /* ---------- init on load ---------- */
    window.addEventListener('load', function(){
      // hide game areas
      document.querySelectorAll('.game-play-area').forEach(g => g.style.display = 'none');
      
      // Header scroll effect
      window.addEventListener('scroll', function() {
        const header = document.querySelector('header');
        if (window.scrollY > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });

      // Animation on scroll
      const animateElements = document.querySelectorAll('.animate');
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const delay = entry.target.classList.contains('delay-1') ? 0.2 : 
                         entry.target.classList.contains('delay-2') ? 0.4 :
                         entry.target.classList.contains('delay-3') ? 0.6 : 0;
            
            setTimeout(() => {
              entry.target.style.opacity = 1;
              entry.target.style.transform = 'translateY(0)';
            }, delay * 1000);
          }
        });
      }, { threshold: 0.1 });
      
      animateElements.forEach(element => {
        element.style.opacity = 0;
        element.style.transform = 'translateY(20px)';
        element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(element);
      });
      
      // Create floating particles for hero section
      createParticles();
      
      // Play welcome sound
      setTimeout(() => {
        playSound('gameStart');
      }, 500);
    });
    
    function createParticles() {
      const particlesContainer = document.querySelector('.particles');
      for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        const size = Math.random() * 10 + 5;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 5;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.animationDelay = `${delay}s`;
        
        particlesContainer.appendChild(particle);
      }
    }

    // nav links smooth scroll
    document.querySelectorAll('.nav-links a').forEach(a => {
      a.addEventListener('click', function(e){
        e.preventDefault();
        const href = this.getAttribute('href') || '#';
        if(href.startsWith('#')){
          const t = document.querySelector(href);
          if(t) t.scrollIntoView({behavior:'smooth', block:'center'});
        }
        playSound('click');
      });
    });
    
    // FAB scroll to games
    document.querySelector('.fab').addEventListener('click', function() {
      document.querySelector('#games').scrollIntoView({behavior:'smooth'});
      playSound('click');
    });
  </script>
</body>
</html>