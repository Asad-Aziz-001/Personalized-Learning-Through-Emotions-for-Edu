<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 3 Quiz - Sentellect</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['\\[', '\\]']] },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script>

  <style>
    :root {
      --primary: #1e40af; --bg: #f8fafc; --white: #ffffff; 
      --success: #10b981; --error: #ef4444; --text: #1e293b;
    }
    body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    
    /* Quiz Card */
    .quiz-card { background: var(--white); padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    
    /* Question Styles */
    .quiz-question { margin-bottom: 30px; padding: 20px; border-left: 4px solid var(--primary); background: #f1f5f9; border-radius: 8px; }
    .quiz-options { display: grid; gap: 10px; margin-top: 15px; }
    
    /* Buttons */
    .quiz-btn {
      padding: 12px; text-align: left; background: white; border: 2px solid #cbd5e1;
      border-radius: 8px; cursor: pointer; transition: all 0.2s; font-weight: 500; width: 100%;
    }
    .quiz-btn:hover { border-color: var(--primary); background: #eff6ff; }
    
    /* Correct/Incorrect States */
    .quiz-btn.correct { background-color: #dcfce7 !important; border-color: var(--success) !important; color: #166534 !important; opacity: 1 !important; }
    .quiz-btn.incorrect { background-color: #fee2e2 !important; border-color: var(--error) !important; color: #991b1b !important; opacity: 1 !important; }
    .quiz-btn:disabled { cursor: not-allowed; opacity: 0.8; }

    /* Feedback Text */
    .quiz-feedback { margin-top: 10px; font-size: 0.95rem; padding: 10px; border-radius: 6px; display: none; }

    /* Result Section (Hidden by default) */
    #finish-area { display: none; text-align: center; padding: 30px; margin-top: 30px; border-radius: 12px; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .btn-action {
      padding: 12px 25px; font-size: 1.1rem; font-weight: bold; color: white;
      border: none; border-radius: 50px; cursor: pointer; transition: transform 0.2s; margin: 10px;
      display: inline-flex; align-items: center; gap: 8px;
    }
    .btn-action:hover { transform: translateY(-2px); }
  </style>
</head>
<body>

<div class="container">
  <div class="quiz-card">
    <h1 style="color: var(--primary); text-align: center;">Chapter 3: Integration</h1>
    <p style="text-align: center; color: #64748b;">Answer at least 5 questions correctly to complete this module.</p>
    <hr style="margin: 20px 0; border-color: #e2e8f0;">

    <div class="interactive-quiz">
      
      <div class="quiz-question" id="q1">
        <p><strong>1.</strong> Use differentials to approximate \(\sqrt{82}\).</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q1', 'Try calculating $9 + \\frac{1}{18}$.')">9.0</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q1', 'Close, but check the fraction.')">9.1</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q1', 'Correct! $f(81)+f\'(81)(1) = 9 + \\frac{1}{18} \\approx 9.055$.')">9.055</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q1', 'Too high.')">9.5</button>
        </div>
        <div class="quiz-feedback" id="q1-feedback"></div>
      </div>

      <div class="quiz-question" id="q2">
        <p><strong>2.</strong> Best method to integrate \(\int x e^{2x} dx\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q2', 'Correct. Integration by Parts with LIATE.')">\(u=x\), \(dv=e^{2x}dx\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q2', 'Choosing $u=e^{2x}$ makes it harder.')">\(u=e^{2x}\), \(dv=x dx\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q2', 'U-sub won\'t work well here.')">U-substitution</button>
        </div>
        <div class="quiz-feedback" id="q2-feedback"></div>
      </div>

      <div class="quiz-question" id="q3">
        <p><strong>3.</strong> How do you solve \(\int \sin^2(x) dx\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q3', 'This requires $\\cos(x)$ for $du$.')">U-sub with $\sin(x)$</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q3', 'Not ideal.')">Integration by Parts</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q3', 'Correct. Use $\\sin^2 x = \\frac{1-\\cos(2x)}{2}$.')">Power Reduction Identity</button>
        </div>
        <div class="quiz-feedback" id="q3-feedback"></div>
      </div>

      <div class="quiz-question" id="q4">
        <p><strong>4.</strong> Correct setup for \(\int \frac{2x}{(x-1)(x+3)} dx\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q4', 'Correct. Distinct linear factors.')">\(\frac{A}{x-1} + \frac{B}{x+3}\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q4', 'Denominator is quadratic, but factors are linear.')">\(\frac{Ax+B}{(x-1)(x+3)}\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q4', 'Product rule is not for partial fractions.')">\(\frac{A}{x-1} \cdot \frac{B}{x+3}\)</button>
        </div>
        <div class="quiz-feedback" id="q4-feedback"></div>
      </div>

      <div class="quiz-question" id="q5">
        <p><strong>5.</strong> Partial fraction setup for \(\frac{x+5}{(x+2)^2}\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q5', 'You need a term for the squared factor too.')">\(\frac{A}{x+2}\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q5', 'Repeated linear factors use constants.')">\(\frac{Ax+B}{(x+2)^2}\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q5', 'Correct. One for power 1, one for power 2.')">\(\frac{A}{x+2} + \frac{B}{(x+2)^2}\)</button>
        </div>
        <div class="quiz-feedback" id="q5-feedback"></div>
      </div>

      <div class="quiz-question" id="q6">
        <p><strong>6.</strong> Decomposition for \(\int \frac{3}{(x-1)(x^2+9)} dx\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q6', 'Quadratic factor needs linear numerator.')">\(\frac{A}{x-1} + \frac{B}{x^2+9}\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q6', 'Correct. Irreducible quadratic gets $Bx+C$.')">\(\frac{A}{x-1} + \frac{Bx+C}{x^2+9}\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q6', 'Too many variables.')">\(\frac{Ax+B}{x-1} + \frac{Cx+D}{x^2+9}\)</button>
        </div>
        <div class="quiz-feedback" id="q6-feedback"></div>
      </div>

      <div class="quiz-question" id="q7">
        <p><strong>7.</strong> Evaluate \(\int_{1}^{2} 2x dx\).</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q7', 'Antiderivative is $x^2$.')">1</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q7', 'Check bounds.')">2</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q7', 'Correct. $[x^2]_1^2 = 4 - 1 = 3$.')">3</button>
        </div>
        <div class="quiz-feedback" id="q7-feedback"></div>
      </div>

      <div class="quiz-question" id="q8">
        <p><strong>8.</strong> Integral for area under \(y=x^2+1\) from \(x=0\) to \(x=2\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q8', 'Correct.')">\(\int_{0}^{2} (x^2+1) dx\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q8', 'Start is 0, not 1.')">\(\int_{1}^{2} (x^2+1) dx\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q8', 'That\'s just values, not area.')">\(f(2) - f(0)\)</button>
        </div>
        <div class="quiz-feedback" id="q8-feedback"></div>
      </div>

      <div class="quiz-question" id="q9">
        <p><strong>9.</strong> Area bounded by \(y=x\) and x-axis from \(x=-1\) to \(1\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q9', 'Area is always positive. Split the integral.')">0</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q9', 'Correct. Area = $|\\int_{-1}^0 x| + \\int_0^1 x = 0.5 + 0.5 = 1$.')">1</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q9', 'Forgot absolute value for negative part.')">1/2</button>
        </div>
        <div class="quiz-feedback" id="q9-feedback"></div>
      </div>

      <div class="quiz-question" id="q10">
        <p><strong>10.</strong> Solution for \(\frac{dy}{dx} = 1\) with \(y(0)=5\)?</p>
        <div class="quiz-options">
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q10', 'Missing constant.')">\(y=x\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, false, 'q10', 'Solve for C.')">\(y=x+C\)</button>
          <button class="quiz-btn" onclick="checkQuiz(this, true, 'q10', 'Correct. General is $y=x+C$. If $x=0, y=5$, then $C=5$.')">\(y=x+5\)</button>
        </div>
        <div class="quiz-feedback" id="q10-feedback"></div>
      </div>

    </div> <div id="finish-area"></div>

  </div>
</div>

<script>
    // --- CONFIGURATION ---
    const CHAPTER_ID = 3; // Defines this as Chapter 3
    const PASS_THRESHOLD = 0.5; // 50% required to pass
    // ---------------------

    let correctAnswers = 0;
    
    // Auto-detect total questions
    const allQuestions = document.querySelectorAll('.quiz-question');
    const totalQuestions = allQuestions.length;
    const questionsToPass = Math.ceil(totalQuestions * PASS_THRESHOLD);

    console.log(`Quiz 3 Loaded: ${totalQuestions} questions. Pass needs ${questionsToPass}.`);

    function checkQuiz(btn, isCorrect, qId, rationale) {
        const parent = document.getElementById(qId);
        const feedback = document.getElementById(qId + '-feedback');
        
        // 1. Prevent duplicate clicks
        if (parent.getAttribute('data-answered') === 'true') return;
        parent.setAttribute('data-answered', 'true');

        // 2. Disable buttons
        const buttons = parent.querySelectorAll('.quiz-btn');
        buttons.forEach(b => {
            b.disabled = true;
            b.style.opacity = "0.6";
            b.style.cursor = "not-allowed";
        });

        // 3. Show Feedback
        feedback.style.display = "block"; 
        
        if (isCorrect) {
            correctAnswers++;
            btn.classList.add('correct');
            btn.style.opacity = "1"; 
            feedback.innerHTML = `<div style="background:#dcfce7; color:#166534; padding:10px; border-radius:6px;"><strong>Correct!</strong> ${rationale}</div>`;
        } else {
            btn.classList.add('incorrect');
            btn.style.opacity = "1"; 
            
            // Highlight correct answer
            buttons.forEach(b => {
                if(b.getAttribute('onclick').includes('true')) {
                    b.classList.add('correct');
                    b.style.opacity = "1";
                }
            });
            feedback.innerHTML = `<div style="background:#fee2e2; color:#991b1b; padding:10px; border-radius:6px;"><strong>Not quite.</strong> ${rationale}</div>`;
        }

        if (window.MathJax) window.MathJax.typesetPromise([feedback]);

        checkCompletion();
    }

    function checkCompletion() {
        const answeredCount = document.querySelectorAll('.quiz-question[data-answered="true"]').length;
        
        if (answeredCount === totalQuestions) {
            showFinalResult();
        }
    }

    function showFinalResult() {
        const finishArea = document.getElementById('finish-area');
        finishArea.style.display = 'block';

        if (correctAnswers >= questionsToPass) {
            // --- PASS UI ---
            finishArea.style.backgroundColor = '#f0fdf4';
            finishArea.style.border = '2px solid #10b981';
            finishArea.innerHTML = `
                <h2 style="color: #15803d; margin-bottom: 10px;">ðŸŽ‰ Module Complete!</h2>
                <p style="font-size: 1.2rem; margin-bottom: 15px;">You scored <strong>${correctAnswers}/${totalQuestions}</strong>.</p>
                <p style="color: #64748b;">You have mastered Integration.</p>
                <br>
                <button id="saveBtn" onclick="saveProgress()" class="btn-action" style="background-color: #10b981; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                    Save Progress & Return to Dashboard
                </button>
            `;
        } else {
            // --- FAIL UI ---
            finishArea.style.backgroundColor = '#fef2f2';
            finishArea.style.border = '2px solid #ef4444';
            finishArea.innerHTML = `
                <h2 style="color: #b91c1c; margin-bottom: 10px;">Keep Practicing</h2>
                <p style="font-size: 1.2rem; margin-bottom: 15px;">You scored <strong>${correctAnswers}/${totalQuestions}</strong>.</p>
                <p style="color: #64748b;">You need ${questionsToPass} correct answers to pass.</p>
                <br>
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="location.reload()" class="btn-action" style="background-color: #ef4444; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
                        <i class="fas fa-redo"></i> Retry Quiz
                    </button>
                    
                    <button onclick="window.location.href='/dashboard'" class="btn-action" style="background-color: #64748b; box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);">
                        <i class="fas fa-arrow-left"></i> Dashboard
                    </button>
                </div>
            `;
        }
        
        setTimeout(() => {
            finishArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
    }

    function saveProgress() {
        const btn = document.getElementById('saveBtn');
        btn.innerText = "Saving...";
        btn.disabled = true;

        fetch('/api/complete_chapter', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chapter: CHAPTER_ID })
        })
        .then(res => res.json())
        .then(data => {
            if (data.redirect) {
                window.location.href = data.redirect;
            } else {
                window.location.href = "/dashboard";
            }
        })
        .catch(err => {
            console.error(err);
            alert("Connection error. Redirecting to dashboard...");
            window.location.href = "/dashboard";
        });
    }
</script>

</body>
</html>